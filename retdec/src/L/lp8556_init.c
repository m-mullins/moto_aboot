//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t bd65060_read_reg(int32_t a1, int32_t a2);
int32_t bd65b60_backlight_off(int32_t a1, int32_t a2, int32_t a3);
int32_t bd65b60_backlight_on(int32_t a1, int32_t a2, int32_t a3);
int32_t bd65b60_init(void);
int32_t get_brightness_59(int32_t a1, int32_t a2, int32_t a3);
int32_t get_brightness_63(int32_t a1, int32_t a2, int32_t a3);
int32_t get_max_brightness_60(int32_t a1, int32_t a2, int32_t a3);
int32_t get_max_brightness_64(int32_t a1, int32_t a2, int32_t a3);
int32_t lm3697_backlight_on(int32_t a1, int32_t a2, int32_t a3);
int32_t lp8556_init(void);
int32_t oem_bd65060(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_bd65060_usage(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_lp8556_usage(int32_t a1, int32_t a2, int32_t a3);
int32_t set_brightness_62(uint32_t a1, int32_t a2);
int32_t set_brightness_66(uint32_t a1, int32_t a2);
int32_t set_default_brightness_61(uint32_t a1, int32_t a2, int32_t a3);
int32_t set_default_brightness_65(uint32_t a1, int32_t a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g12 = 0; // R2
int32_t g13 = 0; // R4
int32_t g14 = 0; // R5
int32_t g15 = 0; // R6
bool g16 = false; // R7
int32_t g1 = 0x746e6300; // 0x8f6a4e20
int32_t g2 = 255; // 0x8f6aca7c
int32_t g3 = 255; // 0x8f6aca84
int32_t g4 = 255; // 0x8f6aca88
char * g5 = "\x01"; // 0x8f6aca8c
int32_t g6 = 255; // 0x8f6aca90
int32_t g7 = 255; // 0x8f6aca94
int32_t g8 = 0; // 0x8f6e0a88
int32_t g9 = 0; // 0x8f6e0a94
int32_t g10 = 0; // 0x8f6e0a98
int32_t g11 = 0; // 0x8f7112f4

// ------------------------ Functions -------------------------

// Address range: 0x8f6407c4 - 0x8f6409cb
int32_t lp8556_init(void) {
    // 0x8f6407c4
    int32_t v1;
    int32_t v2 = v1; // bp-40
    int32_t v3;
    int32_t v4 = v3; // bp-36
    int32_t v5;
    int32_t v6 = v5; // bp-32
    int32_t v7 = g16 ? (int32_t)&g11 : 0; // 0x8f6407c4
    int32_t v8 = g11;
    int32_t v9;
    int32_t v10;
    print_log(2, (int32_t)"%s\n", (int32_t)"lp8556_init", v8, v10, v9, v1, v3, v5, v8, 0, g13, g14);
    int32_t v11 = g10;
    int32_t v12; // 0x8f64096c
    int32_t v13; // 0x8f6409647
    int32_t v14; // 0x8f6409644
    int32_t v15; // R1
    int32_t v16; // 0x8f64094c
    int32_t result2;
    uint32_t v17;
    uint32_t v18;
    if (v11 == 0) {
        int32_t v19 = g8;
        int32_t v20 = v19; // R3
        int32_t v21 = *(int32_t *)(v19 + 44); // 0x8f640810
        int32_t v22 = get_int_prop((int32_t)"blsp", v21, (int32_t)&v2, v19, v10, v9, v1); // 0x8f640814
        int32_t result; // 0x8f6408b8
        if (v22 == 0) {
            int32_t v23 = g8;
            v20 = v23;
            int32_t v24 = *(int32_t *)(v23 + 44); // 0x8f64082c
            int32_t v25 = get_int_prop((int32_t)"qup", v24, (int32_t)&v4, v23, v10, v9, v2); // 0x8f640830
            if (v25 == 0) {
                int32_t v26 = v2; // 0x8f640848_0
                int32_t v27 = v4; // 0x8f64084c_0
                int32_t v28;
                int32_t v29 = qup_blsp_i2c_init(0x1000000 * v26 / 0x1000000, 0x1000000 * v27 / 0x1000000, 0x186a0, 0x124f800, v10, v9, v26, v27, v5, v8, 0, g13, g14, g15, v7, 0, v28); // 0x8f640858
                *(int32_t *)(int32_t)&g10 = v29;
                if (v29 == 0) {
                    // if_8f640864_0_true
                    // branch -> 0x8f6408b8
                    // 0x8f6408b8
                    result = print_log(-1, (int32_t)"%s: qup_i2c_init fail\n", (int32_t)"lp8556_init", 0x124f800, v10, v9, v2, v4, v6, v8, 0, g13, g14);
                    // branch -> 0x8f640970
                    // 0x8f640970
                    if (v8 != g11) {
                        // 0x8f640980
                        __stack_chk_fail();
                        // branch -> 0x8f640984
                    }
                    // 0x8f640984
                    return result;
                }
                int32_t v30 = v4; // 0x8f640874
                int32_t v31 = v2; // 0x8f640888
                print_log(2, (int32_t)"%s, qup_blsp_i2c_init(BLSP_ID_%d, QUP_ID_%d, 100000, 19200000)\n", (int32_t)"lp8556_init", v31, v30, v9, v31, v30, v6, v8, 0, g13, g14);
                int32_t v32 = g8;
                int32_t v33 = *(int32_t *)(v32 + 44); // 0x8f64089c
                int32_t v34 = get_int_prop((int32_t)"reset", v33, (int32_t)&v6, v32, v30, v9, v2); // 0x8f6408a0
                if (v34 == 0) {
                    int32_t v35 = 1; // R4
                    int32_t v36 = 1; // R2
                    v20 = 1;
                    gpio_tlmm_config(v6, 0, 1, 1, 0, 1, v2);
                    gpio_set_dir(v6, 2, v36, v20);
                    gpio_set_value(v6, v35, v36, v20);
                    v13 = 0;
                    v14 = 1;
                    // branch -> 0x8f6408f4
                    // 0x8f6408f4
                    mdelay(5, v35, v36, v20);
                    print_log(2, (int32_t)"%s, LP8556_I2C_ADDRESS = 0x%x\n", (int32_t)"lp8556_init", 44, v13, v14, v2, v4, v6, v8, 0, g13, g14);
                    v17 = g10;
                    qup_i2c_write_byte(v17, 44, 0, 255, v13, v14, v2, v4, v6, v8, 0);
                    if (v17 <= 0xffffffff) {
                        // 0x8f64092c
                        print_log(-1, (int32_t)"%s: fail to write\n", (int32_t)"lp8556_init", 255, v13, v14, v2, v4, v6, v8, 0, g13, g14);
                        // branch -> 0x8f64093c
                    }
                    // 0x8f64093c
                    v18 = g10;
                    v15 = 44;
                    v16 = qup_i2c_write_byte(v18, 44, 1, 133, v13, v14, v2, v4, v6, v8, 0);
                    v12 = v16;
                    if (v18 <= 0xffffffff) {
                        // 0x8f640958
                        v15 = (int32_t)"%s: fail to write\n";
                        print_log(-1, (int32_t)"%s: fail to write\n", (int32_t)"lp8556_init", 133, v13, v14, v2, v4, v6, v8, 0, g13, g14);
                        v12 = (int32_t)"lp8556_init";
                        // branch -> 0x8f640968
                    }
                    // 0x8f640968
                    result2 = mdelay(2, v15, v12, 133);
                    // branch -> 0x8f640970
                } else {
                    // 0x8f6408ac
                    // branch -> 0x8f6408b4
                    // 0x8f6408b4
                    // branch -> 0x8f6408b8
                    // 0x8f6408b8
                    result = print_log(-1, (int32_t)"Property \"reset\" is not defined in dev tree for backlight device %s!", g8, v32, v30, v9, v2, v4, v6, v8, 0, g13, g14);
                    result2 = result;
                    // branch -> 0x8f640970
                }
                // 0x8f640970
                if (v8 != g11) {
                    // 0x8f640980
                    __stack_chk_fail();
                    // branch -> 0x8f640984
                }
                // 0x8f640984
                return result2;
            }
        }
        // 0x8f64083c
        // branch -> 0x8f6408b4
        // 0x8f6408b4
        // branch -> 0x8f6408b8
        // 0x8f6408b8
        result = print_log(-1, (int32_t)"Property \"blsp\" is not defined in dev tree for backlight device %s!", g8, v20, v10, v9, v2, v4, v6, v8, 0, g13, g14);
        result2 = result;
        // branch -> 0x8f640970
    } else {
        v13 = v10;
        v14 = v9;
        // 0x8f6408f4
        mdelay(5, (int32_t)"%s\n", (int32_t)"lp8556_init", v11);
        print_log(2, (int32_t)"%s, LP8556_I2C_ADDRESS = 0x%x\n", (int32_t)"lp8556_init", 44, v13, v14, v2, v4, v6, v8, 0, g13, g14);
        v17 = g10;
        qup_i2c_write_byte(v17, 44, 0, 255, v13, v14, v2, v4, v6, v8, 0);
        if (v17 <= 0xffffffff) {
            // 0x8f64092c
            print_log(-1, (int32_t)"%s: fail to write\n", (int32_t)"lp8556_init", 255, v13, v14, v2, v4, v6, v8, 0, g13, g14);
            // branch -> 0x8f64093c
        }
        // 0x8f64093c
        v18 = g10;
        v15 = 44;
        v16 = qup_i2c_write_byte(v18, 44, 1, 133, v13, v14, v2, v4, v6, v8, 0);
        v12 = v16;
        if (v18 <= 0xffffffff) {
            // 0x8f640958
            v15 = (int32_t)"%s: fail to write\n";
            print_log(-1, (int32_t)"%s: fail to write\n", (int32_t)"lp8556_init", 133, v13, v14, v2, v4, v6, v8, 0, g13, g14);
            v12 = (int32_t)"lp8556_init";
            // branch -> 0x8f640968
        }
        // 0x8f640968
        result2 = mdelay(2, v15, v12, 133);
        // branch -> 0x8f640970
    }
    // 0x8f640970
    if (v8 != g11) {
        // 0x8f640980
        __stack_chk_fail();
        // branch -> 0x8f640984
    }
    // 0x8f640984
    return result2;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// long int atol(const char * nptr);
// int strcmp(const char * s1, const char * s2);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 17
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:46:56
