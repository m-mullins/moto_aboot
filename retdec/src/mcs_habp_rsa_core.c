//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t __utag_defined(int32_t a1, int32_t a2);
char * __utag_typeof(void);
int32_t handle_fboot_command_boot(int32_t * a1, int32_t a2, int32_t a3, int32_t a4);
int32_t handle_fboot_command_continue(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t heap_alloc(uint32_t a1, uint32_t a2);
int32_t heap_free(void);
int32_t is_piv_magic(char * str, int32_t a2);
char * is_secure_boot_enable(int32_t a1);
int32_t mcs_clear_rng_ctx(int32_t a1, int32_t a2);
int32_t mcs_habp_rsa_core(int32_t a1, int32_t a2, int32_t a3, int32_t a4, uint32_t a5, int32_t a6, int32_t * a7);
int32_t mcs_habp_rsa_crt_large(int32_t a1, int32_t a2, int32_t a3);
int32_t mcs_rsa_do_rsa(char * a1, int32_t a2, int32_t a3, uint32_t a4);
int32_t mdp_dsi_cmd_config(int32_t a1, int32_t a2);
int32_t mdp_dsi_video_on(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t mdss_qos_remapper_setup(int32_t result, int32_t a2, int32_t a3);
char * mdss_vbif_qos_remapper_setup(int32_t a1);
int32_t mipi_dsi_cmd_bta_sw_trigger(int32_t a1, int32_t a2, int32_t a3);
int32_t mipi_dsi_cmds_rx(int32_t * a1, int32_t result);
int32_t misc_check_mode(char * a1, int32_t a2);
int32_t pm8x41_chgr_led_enable(int32_t a1, int32_t a2);
int32_t rtc_get(void);
char * scm_io_write(int32_t a1, int32_t a2, int32_t a3);
int32_t set_accessory_type(int32_t a1);
int32_t thread_init(int32_t a1, int32_t a2);
int32_t thread_init_early(void);
int32_t thread_sleep(int32_t a1);
int32_t type_atoi_98(char * str, int32_t a2, int32_t a3);
int32_t XXH32(char * a1, int32_t a2, int32_t a3);
int32_t XXH32_resetState(int32_t * a1, int32_t a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g25 = 0; // R0
int32_t g26 = 0; // R1
int32_t g27 = 0; // R11
int32_t g28 = 0; // R2
int32_t g29 = 0; // R4
int32_t g30 = 0; // R5
int32_t g31 = 0; // R6
int32_t g32 = 0; // R7
int32_t g33 = 0; // R8
int32_t g34 = 0; // R9
int32_t g1 = -0x16d2bfc9; // 0x8f61b264
char * g2; // 0x8f622364
int32_t g3 = -0x16d2bfc9; // 0x8f6387c0
int32_t g4 = -0x16d2bc09; // 0x8f638ab0
char * g5 = "\x01"; // 0x8f6a3f48
char * g6 = "\x4d\x4f\x54\x4f\x13\x57\x9b"; // 0x8f6a42ac
int32_t g7 = 1; // 0x8f6ac0f0
int32_t g8 = 10; // 0x8f6afe00
char (*g9)[14] = "boot-recovery"; // 0x8f6aff94
int32_t g10 = 0; // 0x8f6c0064
int32_t g11 = 0; // 0x8f6c0164
int32_t g12 = 0; // 0x8f6c0168
char * g13; // 0x8f6c016c
int32_t g14 = 0; // 0x8f6c0170
int32_t g15 = 0; // 0x8f6c0174
int32_t g16 = 0; // 0x8f6c0180
int32_t g17 = 0; // 0x8f6c0184
int32_t g18 = 0; // 0x8f6c0188
int32_t g19 = 0; // 0x8f6c01b0
int32_t g20 = 0; // 0x8f6e0bf0
int32_t g21 = 0; // 0x8f6e0bf4
char * g22; // 0x8f6ed840
int32_t g23 = 0; // 0x8f7112f4
int32_t g24 = 0; // 0x8f7114ac

// ------------------------ Functions -------------------------

// Address range: 0x8f665e5c - 0x8f666267
int32_t mcs_habp_rsa_core(int32_t a1, int32_t a2, int32_t a3, int32_t a4, uint32_t a5, int32_t a6, int32_t * a7) {
    int32_t v1 = 0; // R8
    int32_t v2 = a5 % 0x10000; // 0x8f665e7c
    int32_t result = g23;
    int32_t v3 = (int32_t)a7; // R4
    int32_t v4;
    int32_t v5 = v4; // bp-72
    int32_t v6 = (a3 + 1) / 2; // 0x8f665ec8
    int32_t v7 = (a3 + 3) / 4; // 0x8f665ed4
    int32_t v8 = 4 * v7; // 0x8f665edc
    int32_t v9 = v8; // R11
    int32_t v10 = v7 + 1; // 0x8f665ee0
    int32_t v11 = 0x10000 * v10 / 0x10000; // 0x8f665ee4_0
    int32_t v12;
    int32_t v13;
    int32_t v14;
    mcs_bytes_to_mpint(v4, a2, a3, v10, v14, v13, v12);
    uint32_t v15 = v9; // 0x8f665ef0
    int32_t v16 = v15 + 4; // R7
    int32_t v17 = 4 * v7; // 0x8f665f00
    *(int32_t *)(v4 + v17) = v1;
    int32_t v18;
    *(int32_t *)(4 * v7 + v18) = v1;
    int32_t v19 = &v5; // 0x8f665f10_0
    mcs_initialize_montgomery_alg(v19, a2, v19, v18, v14, v13);
    int32_t v20;
    int32_t v21;
    mcs_multi_convert_to_multi_digit_byte_len(a2, v20, a3, v18, v14, v13, v19, v7, a6, v6, v21, v20, v4, v18);
    int32_t v22 = 1; // R10
    int32_t v23 = v15 / 2; // 0x8f665f38
    int32_t v24 = 2 * v23; // R9
    mcs_memset(v3 + 4, v1, 8 * v23, v18);
    int32_t v25 = v3; // 0x8f665f4c
    int32_t v26 = v22; // 0x8f665f50
    *(int32_t *)v25 = v26;
    int32_t v27;
    mcs_habp_rsa_mod(v25, v24 + v26, v20, v6, v14, v13, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11, 0, 0, v27, v18, 0, result);
    int32_t v28 = v22 - v6; // 0x8f665f70
    mcs_multi_convert_from_multi_digit_byte_len(4 * (v28 + v24) + v3, a6, a3, v28, v14, v13, v19, v7, a6, v6, v21, v20, v4, v18);
    mcs_bytes_to_mpint(v18, a6, a3, v28, v14, v13, v19);
    mcs_memset(a6, v1, a3 - 1, v28);
    int32_t v29 = a6; // R2
    int32_t v30 = a3 + a6; // 0x8f665fa8
    *(char *)(v30 - 1) = (char)v22;
    int32_t v31; // 0x8f6661c07
    int32_t v32; // 0x8f6661cc
    int32_t v33; // 0x8f6661c011
    int32_t v34; // 0x8f6661c05
    int32_t v35; // R3
    int32_t v36;
    int32_t v37; // 0x8f666230
    int32_t v38; // 0x8f6661a8
    int32_t v39; // 0x8f6661bc
    int32_t v40; // 0x8f6661d8
    if (v36 != v1) {
        // 0x8f666084
        v22 = v16 + v36;
        mcs_bytes_to_mpint(v36, a1, a3, v30, v14, v13, v19);
        v24 = 2 * v16 + v36;
        *(int32_t *)(v36 + v17) = v1;
        mcs_mp_mont_prod(v19, v22, v36, v18, v14, v13, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11);
        int32_t v41 = 0x3fffffff * v16; // 0x8f6660bc
        int32_t v42 = v24; // 0x8f6660c8
        int32_t v43 = v42 + v41; // 0x8f6660c8
        v29 = v43;
        mcs_mp_mont_prod(v19, v42, v43, v22, v41, v13, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11);
        int32_t v44 = 14; // 0x8f6660e0
        int32_t v45 = v44 - 1; // 0x8f6660e0
        int32_t v46 = v24 + v16; // 0x8f6660e4
        // branch -> 0x8f6660c8
        while (v44 != 1) {
            // 0x8f6660c8
            v42 = v46;
            v43 = v42 + v41;
            v29 = v43;
            mcs_mp_mont_prod(v19, v42, v43, v22, v41, v13, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11);
            v44 = v45;
            v45 = v44 - 1;
            v46 += v16;
            // continue -> 0x8f6660c8
        }
        // 0x8f6660f0
        v35 = v2;
        if (v45 >= v2) {
            while (true) {
                // 0x8f666104
                v22 = 2;
                int32_t v47 = (int32_t)*(char *)(v45 + a4); // 0x8f66610c
                v9 = v47;
                int32_t v48 = v45; // 0x8f66619c54
                int32_t v49 = 2; // 0x8f66618842
                int32_t v50 = v45; // 0x8f666110
                int32_t v51 = v41; // 0x8f6661c017
                int32_t v52 = v13; // 0x8f6661c04
                // branch -> 0x8f666110
                while (true) {
                    int32_t v53 = v47 / 16; // 0x8f666114
                    int32_t v54; // 0x8f6661c015
                    int32_t v55; // 0x8f6661c02
                    if (v50 == 0) {
                        int32_t v56 = v48; // 0x8f66619c53
                        int32_t v57 = v49; // 0x8f666188
                        int32_t v58 = v47; // 0x8f666184
                        int32_t v59 = v51; // 0x8f6661c016
                        int32_t v60 = v52; // 0x8f6661c03
                        int32_t v61 = 0; // 0x8f66611036
                        if (v47 >= 16) {
                            int32_t v62 = v36 + v16 * v53; // 0x8f666178
                            mcs_mp_copy(v19, v3, v62, v53, v51);
                            v54 = v51;
                            v55 = v52;
                            // branch -> 0x8f666180
                          lab_0x8f666180_2:
                            // 0x8f666180
                            v56 = 1;
                            v57 = v22;
                            v58 = v9;
                            v59 = v54;
                            v60 = v55;
                            v61 = 1;
                            // branch -> 0x8f666184
                        }
                      lab_0x8f666184:;
                        int32_t v63 = v57 - 1; // 0x8f666188
                        v22 = v63;
                        int32_t v64 = 16 * v58 & 240; // 0x8f66618c
                        v9 = v64;
                        if (v57 == 1) {
                            // break -> 0x8f666194
                            break;
                        }
                        v48 = v56;
                        v49 = v63;
                        v47 = v64;
                        v50 = v61;
                        v51 = v59;
                        v52 = v60;
                        // continue -> 0x8f666110
                        continue;
                    } else {
                        // branch -> 0x8f666120
                        for (int32_t i = 4; i > 0; i--) {
                            // 0x8f666120
                            mcs_mp_mont_sqr(v19, v3, v3, v53, i, v53, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11, 0);
                            // continue -> 0x8f666120
                        }
                        // 0x8f666148
                        if (v47 < 16) {
                            v54 = 1;
                            v55 = 0;
                            goto lab_0x8f666180_2;
                        }
                        // 0x8f666150
                        mcs_mp_mont_prod(v19, v3, v3, v36 + v16 * v53, 1, v53, v19, v7, a6, v6, v21, v20, v4, v18, a1, a4, v2, v27, v5, v11);
                        v54 = 1;
                        v55 = v53;
                        // branch -> 0x8f666180
                        goto lab_0x8f666180_2;
                    }
                }
            }
        } else {
            v33 = v41;
            v31 = v21;
            v34 = v13;
        }
        // 0x8f66619c
        v32 = v2;
        if (v45 != 0) {
            // 0x8f6661a4
            v38 = v3;
            mcs_mp_mont_reduce(v19, v38, v38, v2, v33, v34, v19, v7, a6, v6, v31, v20, v4, v18, a1, a4, v2, v27, v5);
            v39 = a3;
            v29 = v39;
            mcs_mpint_to_bytes(a6, v3, v39, v35, v33, v34, v19, v7, a6, v6, v31);
            v32 = v35;
            // branch -> 0x8f6661c4
        }
        // 0x8f6661c4
        mcs_memclear(v19, 28, v29, v32);
        v40 = v3;
        v3 = v8 + 4;
        mcs_memclear(v40, 16 * v7 | 4, v29, v35);
        mcs_memclear(v20, 4 * v6, v6, v35);
        mcs_memclear(v4, v3, v6, v7);
        mcs_memclear(v18, v3, v6, v7);
        mcs_memclear(v27, 8 * v7 + 28, v6, v7);
        v37 = v36;
        if (v37 != 0) {
            // 0x8f666238
            mcs_memclear(v37, 64 * v10, v6, v7);
            // branch -> 0x8f666244
        }
        // 0x8f666244
        if (result != g23) {
            // 0x8f666258
            __stack_chk_fail();
            // branch -> 0x8f66625c
        }
        // 0x8f66625c
        return result;
    }
    // 0x8f665fb4
    v16 += v3;
    v1 = v36;
    v35 = v2;
    if (v36 < v2) {
        v33 = v14;
        v31 = v21;
        v34 = v13;
        // 0x8f66619c
        v32 = v2;
        if (v36 != 0) {
            // 0x8f6661a4
            v38 = v3;
            mcs_mp_mont_reduce(v19, v38, v38, v2, v33, v34, v19, v7, a6, v6, v31, v20, v4, v18, a1, a4, v2, v27, v5);
            v39 = a3;
            v29 = v39;
            mcs_mpint_to_bytes(a6, v3, v39, v35, v33, v34, v19, v7, a6, v6, v31);
            v32 = v35;
            // branch -> 0x8f6661c4
        }
        // 0x8f6661c4
        mcs_memclear(v19, 28, v29, v32);
        v40 = v3;
        v3 = v8 + 4;
        mcs_memclear(v40, 16 * v7 | 4, v29, v35);
        mcs_memclear(v20, 4 * v6, v6, v35);
        mcs_memclear(v4, v3, v6, v7);
        mcs_memclear(v18, v3, v6, v7);
        mcs_memclear(v27, 8 * v7 + 28, v6, v7);
        v37 = v36;
        if (v37 != 0) {
            // 0x8f666238
            mcs_memclear(v37, 64 * v10, v6, v7);
            // branch -> 0x8f666244
        }
        // 0x8f666244
        if (result != g23) {
            // 0x8f666258
            __stack_chk_fail();
            // branch -> 0x8f66625c
        }
        // 0x8f66625c
        return result;
    }
    int32_t v65 = v36; // 0x8f66602c51
    int32_t v66 = v36; // 0x8f665fe046
    int32_t v67 = v36; // 0x8f665fdc
    int32_t v68 = v14; // 0x8f6661c01223
    int32_t v69; // 0x8f66602c49
    while (true) {
        // 0x8f665fd0
        v35 = a4;
        int32_t v70 = (int32_t)*(char *)(v67 + a4); // 0x8f665fdc
        v22 = v70;
        int32_t v71 = v65; // 0x8f66602c
        int32_t v72 = v66; // 0x8f665fe0
        int32_t v73 = v68; // 0x8f6661c010
        int32_t v74 = 8; // 0x8f6661c09
        // branch -> 0x8f665fe0
        int32_t v75; // 0x8f6661c013
        int32_t v76; // 0x8f665fe045
        while (true) {
            // 0x8f665fe0
            int32_t v77; // 0x8f6661c014
            int32_t v78; // 0x8f666068
            if (v72 == 0) {
                // 0x8f666018
                if ((v70 & 128) != 0) {
                    // 0x8f666020
                    mcs_bytes_to_mpint(v16, a1, a3, v35, v71, v13, v19);
                    v35 = v18;
                    *(int32_t *)(v9 + v16) = v71;
                    mcs_mp_mont_prod(v19, v3, v16, v35, v71, v13, v19, v7, a6, v6, v74, v20, v4, v18, a1, a4, v2, v27, v5, v11);
                    mcs_mp_copy(v19, v16, v3, v35, v71);
                    v77 = v71;
                    // branch -> 0x8f666060
                  lab_0x8f666060_2:
                    // 0x8f666060
                    v78 = v22;
                    v69 = 1;
                    v75 = v77;
                    v76 = 1;
                    // branch -> 0x8f666064
                } else {
                    v78 = v70;
                    v69 = v71;
                    v75 = v73;
                    v76 = 0;
                }
            } else {
                int32_t v79 = v3; // 0x8f665fec
                mcs_mp_mont_sqr(v19, v79, v79, v35, v73, v13, v19, v7, a6, v6, v74, v20, v4, v18, a1, a4, v2, v27, v5, v11, 0);
                if ((v22 & 128) == 0) {
                    v77 = v73;
                    goto lab_0x8f666060_2;
                }
                int32_t v80 = v3; // 0x8f666004
                v35 = v16;
                mcs_mp_mont_prod(v19, v80, v80, v16, v73, v13, v19, v7, a6, v6, v74, v20, v4, v18, a1, a4, v2, v27, v5, v11);
                v77 = v73;
                // branch -> 0x8f666060
                goto lab_0x8f666060_2;
            }
            int32_t v81 = v74 - 1; // 0x8f66606c
            v29 = v81;
            int32_t v82 = 2 * v78 & 254; // 0x8f666070
            v22 = v82;
            if (v74 == 1) {
                // break -> 0x8f66607c
                break;
            }
            v71 = v69;
            v70 = v82;
            v72 = v76;
            v73 = v75;
            v74 = v81;
            // continue -> 0x8f665fe0
        }
        int32_t v83 = v1 + 1; // 0x8f66607c
        v1 = v83;
        v35 = v2;
        if (v83 < v2) {
            v33 = v75;
            v31 = 0;
            v34 = v13;
            // break -> 0x8f66619c
            break;
        }
        v65 = v69;
        v66 = v76;
        v67 = v83;
        v68 = v75;
        // continue -> 0x8f665fd0
    }
    // 0x8f66619c
    v32 = v2;
    if (v69 != 0) {
        // 0x8f6661a4
        v38 = v3;
        mcs_mp_mont_reduce(v19, v38, v38, v2, v33, v34, v19, v7, a6, v6, v31, v20, v4, v18, a1, a4, v2, v27, v5);
        v39 = a3;
        v29 = v39;
        mcs_mpint_to_bytes(a6, v3, v39, v35, v33, v34, v19, v7, a6, v6, v31);
        v32 = v35;
        // branch -> 0x8f6661c4
    }
    // 0x8f6661c4
    mcs_memclear(v19, 28, v29, v32);
    v40 = v3;
    v3 = v8 + 4;
    mcs_memclear(v40, 16 * v7 | 4, v29, v35);
    mcs_memclear(v20, 4 * v6, v6, v35);
    mcs_memclear(v4, v3, v6, v7);
    mcs_memclear(v18, v3, v6, v7);
    mcs_memclear(v27, 8 * v7 + 28, v6, v7);
    v37 = v36;
    if (v37 != 0) {
        // 0x8f666238
        mcs_memclear(v37, 64 * v10, v6, v7);
        // branch -> 0x8f666244
    }
    // 0x8f666244
    if (result != g23) {
        // 0x8f666258
        __stack_chk_fail();
        // branch -> 0x8f66625c
    }
    // 0x8f66625c
    return result;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// int memcmp(const void * s1, const void * s2, size_t n);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// void * memset(void * s, int c, size_t n);
// int strcmp(const char * s1, const char * s2);
// size_t strlen(const char * s);
// int strncmp(const char * s1, const char * s2, size_t n);
// char * strrchr(char * s, int c);

// --------------- Instruction-Idiom Functions ----------------

// int32_t llvm_bswap_i32(int32_t a1);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 29
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 19:29:06
