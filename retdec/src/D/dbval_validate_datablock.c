//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t __utag_describe(int32_t a1, int32_t a2, int32_t a3);
int32_t __utag_format(char * a1, int32_t a2, char * a3, int32_t a4, int32_t a5);
int32_t cmd_multiflash_mmc_img(char * str, char * a2, int32_t a3, int32_t a4);
int32_t cmd_multiflash_mmc_sparse_img(int32_t a1, char * a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6, int32_t a7, int32_t a8, int32_t a9, int32_t a10, int32_t a11, int32_t a12);
int32_t dbval_provision_store(char * a1, int32_t * a2, char * a3);
int32_t dbval_validate_datablock(int32_t a1, int32_t a2, int32_t a3, char * a4);
int32_t disable_charger_mode(int32_t a1, int32_t a2);
int32_t fastboot_init_validators(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t fboot_cmd_multiflash_validate(int32_t a1, int32_t a2);
int32_t get_delay_abs_time(int32_t a1, int32_t a2, int32_t a3);
int32_t get_offset_ui_setting(int32_t a1, int32_t a2);
int32_t get_schedule_abs_time(int32_t a1);
int32_t is_recovery_mode(char * a1, int32_t a2, int32_t a3, int32_t a4);
int32_t mcs_clear_rsa_ctx(char * a1, int32_t a2, int32_t a3);
int32_t mcs_hashSHA(int32_t a1, int32_t * a2, int32_t * a3);
int32_t mcs_mp_mont_prod(int32_t * a1, int32_t a2, int32_t a3, int32_t a4);
int32_t mcs_mp_mont_reduce(int32_t * a1, int32_t a2, int32_t a3);
int32_t mutex_acquire(int32_t a1, int32_t a2);
int32_t mutex_release(int32_t a1);
int32_t recovery_mode(int32_t a1, int32_t a2, int32_t a3);
int32_t start_usb_detection(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6);
int32_t stop_charging(int32_t a1, int32_t a2);
int32_t stop_usb_detection(int32_t a1, int32_t a2);
int32_t target_display_pre_on(int32_t a1, int32_t a2, int32_t a3);
int32_t target_reboot_device(int32_t a1);
int32_t thread_preempt(void);
int32_t thread_resume(int32_t a1, int32_t a2);
int32_t wififlash_mode(int32_t a1, int32_t a2, int32_t a3);
int32_t XXH32_intermediateDigest(void);
int32_t XXH32_update(char * a1, char * a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g43 = 0; // LR
int32_t g44 = 0; // R0
int32_t g45 = 0; // R1
int32_t g46 = 0; // R10
int32_t g47 = 0; // R11
int32_t g48 = 0; // R2
int32_t g49 = 0; // R4
int32_t g50 = 0; // R5
int32_t g51 = 0; // R6
int32_t g52 = 0; // R7
int32_t g53 = 0; // R8
int32_t g54 = 0; // R9
int32_t g1 = -0x1a60cfd8; // 0x8f62dd14
int32_t g2 = -0x1a60cfd8; // 0x8f62dd48
int32_t g3 = -0x16d2bfed; // 0x8f62dd7c
int32_t g4 = -0x16d2bf09; // 0x8f62dee0
int32_t g5 = -0x16d2bf8d; // 0x8f62e0bc
int32_t g6 = -0x16d2bfc9; // 0x8f62e21c
int32_t g7 = -0x16d2bf8d; // 0x8f62e284
int32_t g8 = -0x16d2bfc9; // 0x8f62e74c
int32_t g9 = -0x16d2b010; // 0x8f62e900
int32_t g10 = -0x16d2bc10; // 0x8f62eb6c
int32_t g11 = -0x1a60c1d8; // 0x8f62f18c
int32_t g12 = -0x16d2bf8d; // 0x8f630638
int32_t g13 = -0x16d2bf09; // 0x8f634ac0
char * g14 = "\x01"; // 0x8f6a3f48
int32_t g15 = 1; // 0x8f6ac0f0
char * g16 = "\n"; // 0x8f6ac1b0
int32_t g17 = -1; // 0x8f6ac1c4
char * g18 = "\xf1"; // 0x8f6affa8
int32_t g19 = 0; // 0x8f6c0378
int32_t g20 = 0; // 0x8f6c037c
int64_t g21 = 0; // 0x8f6c0380
int32_t g22 = 0; // 0x8f6c0384
int32_t g23 = 0; // 0x8f6c0388
int32_t g24 = 0; // 0x8f6c038c
char * g25; // 0x8f6c0394
char * g26; // 0x8f6c03b8
int32_t g27 = 0; // 0x8f6c03c8
int32_t g28 = 0; // 0x8f6c03cc
char * g29; // 0x8f6c03d4
int32_t g30 = 0; // 0x8f6c03dc
char * g31; // 0x8f6c03e0
int32_t g32 = 0; // 0x8f6e07ec
int32_t g33 = 0; // 0x8f6e07f4
int32_t g34 = 0; // 0x8f6e0828
int16_t * g35 = NULL; // 0x8f70da9c
int32_t g36 = 0; // 0x8f70da9e
int32_t g37 = 0; // 0x8f7112f4
int32_t g38 = 0; // 0x8f7114ac
int32_t g39 = 0; // 0x8f7114f4
int32_t g40 = 0; // 0x8f7114f8
int32_t g41 = 0; // 0x8f71150c
int32_t g42 = 0; // 0x8f711510

// ------------------------ Functions -------------------------

// Address range: 0x8f6631d8 - 0x8f663377
int32_t dbval_validate_datablock(int32_t a1, int32_t a2, int32_t a3, char * a4) {
    int32_t v1 = (int32_t)a4; // R9
    int32_t v2 = g37;
    int32_t v3 = v2; // R3
    int32_t v4 = 20; // R10
    int32_t v5;
    int32_t v6 = v5; // R6
    char * v7 = dbval_malloc(20, a2); // 0x8f663208
    int32_t v8 = a3; // 0x8f66320c
    int32_t v9 = v8; // R1
    int32_t v10;
    int32_t v11 = &v10; // 0x8f663210_0
    int32_t v12 = v11; // R2
    int32_t v13 = v4; // bp-48
    int32_t v14 = (int32_t)v7; // R4
    int32_t result = 85;
    int32_t v15;
    int32_t v16; // 0x8f663300
    if (dbval_db_validate_gen_hdr(a1, v8, v11, v3, v15, 0, 0, 0, v4, v2, 0, g49, g50, g51) == 15) {
        // 0x8f66322c
        int32_t v17; // 0x8f6632a4
        int32_t v18; // 0x8f663358
        uint32_t v19; // 0x8f6632b8
        int32_t v20; // 0x8f663280
        int32_t v21; // 0x8f663344
        int32_t v22; // 0x8f663348
        int32_t v23; // 0x8f663348
        if (v14 == 0) {
            // after_if_8f66323c_0
            v3 = 11;
            v10 = 11;
            // branch -> 0x8f663290
        } else {
            // after_if_8f663230_0
            v3 = 11;
            v10 = 11;
            int32_t v24; // R11
            if (v6 == 0) {
                // after_if_8f663240_0.thread
                v24 = 0;
                // branch -> 0x8f663290
            } else {
                // 0x8f663248
                v24 = 1;
                int32_t v25 = v9 & -0x10000 | 2404; // 0x8f66324c
                v9 = v25;
                v12 = v14;
                int32_t v26 = &v13; // 0x8f663254_0
                v3 = v26;
                if (dbval_calc_hash(a2, v25, v14, v26, v15, 0, 0, 0, v4, v2, 0, g49, g50, g51, g52) == 15) {
                    // 0x8f663264
                    v9 = v6;
                    v12 = v4;
                    if (dbval_memcmp(v14, v6, v4, v3) == 0) {
                        // 0x8f66327c
                        v20 = v14;
                        v9 = v20;
                        v12 = 20;
                        dbval_memcpy(v6, v20, 20, v3);
                        // branch -> 0x8f6632b8
                        // 0x8f6632b8
                        v19 = a3;
                        v3 = 13;
                        v10 = 13;
                        if (v19 == 51) {
                          lab_0x8f663338:
                            // 0x8f663338
                            // branch -> 0x8f66333c
                            // 0x8f66333c
                            dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                            v21 = 364;
                            v9 = v21;
                            v22 = a1;
                            v23 = v22 + v21;
                            v12 = v23;
                            v3 = 128;
                            dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                            dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                            // branch -> 0x8f663300
                        } else {
                            // 0x8f6632c8
                            if (v19 > 51) {
                                // 0x8f6632dc
                                result = 85;
                                switch (v19) {
                                    case 170: {
                                        // 0x8f6632f4
                                        // branch -> 0x8f66333c
                                        // 0x8f66333c
                                        dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                                        v21 = 40;
                                        v9 = v21;
                                        v22 = a1;
                                        v23 = v22 + v21;
                                        v12 = v23;
                                        v3 = 128;
                                        v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                                        result = v18;
                                        // branch -> 0x8f663300
                                        break;
                                    }
                                    case 240: {
                                        // if_8f6632e8_0_true
                                        // branch -> 0x8f66333c
                                        // 0x8f66333c
                                        dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                                        v21 = 98;
                                        v9 = v21;
                                        v22 = a1;
                                        v23 = v22 + v21;
                                        v12 = v23;
                                        v3 = 128;
                                        v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                                        result = v18;
                                        // branch -> 0x8f663300
                                        break;
                                    }
                                }
                              lab_0x8f663300:
                                // 0x8f663300
                                v16 = v1;
                                if (v16 != 0) {
                                  lab_if_8f663304_0_true_10:;
                                    int32_t v27 = 0x1000000 * v10 / 0x1000000; // 0x8f663304
                                    v3 = v27;
                                    *(char *)v16 = (char)v27;
                                    // branch -> after_if_8f663308_0
                                }
                              lab_after_if_8f663308_0_10:
                                // after_if_8f663308_0
                                if (v14 != 0) {
                                    // 0x8f663314
                                    dbval_free(v14, v9, v12, v3);
                                    // branch -> 0x8f66331c
                                }
                                // 0x8f66331c
                                v9 = &g37;
                                v12 = v2;
                                if (v2 == g37) {
                                    // 0x8f663364
                                    return result;
                                }
                                // 0x8f663334
                                __stack_chk_fail();
                                // branch -> 0x8f663338
                                goto lab_0x8f663338;
                            } else {
                                // 0x8f6632cc
                                if (v19 == 15) {
                                    // if_8f6632d0_0_true
                                    a3 = 68;
                                    // branch -> 0x8f66333c
                                  lab_0x8f66333c:
                                    // 0x8f66333c
                                    dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                                    v21 = a3;
                                    v9 = v21;
                                    v22 = a1;
                                    v23 = v22 + v21;
                                    v12 = v23;
                                    v3 = 128;
                                    v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                                    result = v18;
                                    // branch -> 0x8f663300
                                    goto lab_0x8f663300;
                                }
                                // 0x8f663300
                                v16 = v1;
                                if (v16 == 0) {
                                    goto lab_after_if_8f663308_0_10;
                                }
                                goto lab_if_8f663304_0_true_10;
                            }
                        }
                      lab_0x8f663300_3:
                        // 0x8f663300
                        v16 = v1;
                        if (v16 == 0) {
                            goto lab_after_if_8f663308_0_10;
                        }
                        goto lab_if_8f663304_0_true_10;
                    }
                }
            }
            // 0x8f663290
            dbval_debug_print2((int32_t)"dbval_validate_datablock - Check Cert Chain", v9, v12);
            v9 = 0;
            v12 = 0;
            v17 = dbval_validate_cert_chain(a2, 0, 0, v3, v15, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54);
            result = 85;
            if (v17 == 15) {
                // 0x8f6632b0
                if (v24 != 0) {
                    // 0x8f66327c
                    v20 = v14;
                    v9 = v20;
                    v12 = 20;
                    dbval_memcpy(v6, v20, 20, v3);
                    // branch -> 0x8f6632b8
                }
                // 0x8f6632b8
                v19 = a3;
                v3 = 13;
                v10 = 13;
                if (v19 == 51) {
                    // 0x8f663338
                    a3 = 364;
                    // branch -> 0x8f66333c
                    goto lab_0x8f66333c;
                } else {
                    // 0x8f6632c8
                    if (v19 > 51) {
                        // 0x8f6632dc
                        result = 85;
                        switch (v19) {
                            case 170: {
                                // 0x8f6632f4
                                // branch -> 0x8f66333c
                                // 0x8f66333c
                                dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                                v21 = 40;
                                v9 = v21;
                                v22 = a1;
                                v23 = v22 + v21;
                                v12 = v23;
                                v3 = 128;
                                v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                                result = v18;
                                // branch -> 0x8f663300
                                goto lab_0x8f663300_3;
                            }
                            case 240: {
                                // if_8f6632e8_0_true
                                // branch -> 0x8f66333c
                                // 0x8f66333c
                                dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                                v21 = 98;
                                v9 = v21;
                                v22 = a1;
                                v23 = v22 + v21;
                                v12 = v23;
                                v3 = 128;
                                v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                                result = v18;
                                // branch -> 0x8f663300
                                goto lab_0x8f663300_3;
                            }
                        }
                      lab_0x8f663300_4:
                        // 0x8f663300
                        v16 = v1;
                        if (v16 == 0) {
                            goto lab_after_if_8f663308_0_10;
                        }
                        goto lab_if_8f663304_0_true_10;
                    } else {
                        // 0x8f6632cc
                        if (v19 == 15) {
                            // if_8f6632d0_0_true
                            a3 = 68;
                            // branch -> 0x8f66333c
                          lab_0x8f66333c_2:
                            // 0x8f66333c
                            dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                            v21 = a3;
                            v9 = v21;
                            v22 = a1;
                            v23 = v22 + v21;
                            v12 = v23;
                            v3 = 128;
                            v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                            result = v18;
                            // branch -> 0x8f663300
                            goto lab_0x8f663300_4;
                        }
                        // 0x8f663300
                        v16 = v1;
                        if (v16 == 0) {
                            goto lab_after_if_8f663308_0_10;
                        }
                        goto lab_if_8f663304_0_true_10;
                    }
                }
            }
          lab_0x8f663300_6:
            // 0x8f663300
            v16 = v1;
            if (v16 == 0) {
                goto lab_after_if_8f663308_0_10;
            }
            goto lab_if_8f663304_0_true_10;
        }
        // 0x8f663290
        dbval_debug_print2((int32_t)"dbval_validate_datablock - Check Cert Chain", v9, v12);
        v9 = 0;
        v12 = 0;
        v17 = dbval_validate_cert_chain(a2, 0, 0, v3, v15, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54);
        if (v17 == 15) {
            // 0x8f6632b8
            v19 = a3;
            v3 = 13;
            v10 = 13;
            if (v19 == 51) {
                // 0x8f663338
                a3 = 364;
                // branch -> 0x8f66333c
                goto lab_0x8f66333c_2;
            } else {
                // 0x8f6632c8
                if (v19 > 51) {
                    // 0x8f6632dc
                    result = 85;
                    switch (v19) {
                        case 170: {
                            // 0x8f6632f4
                            // branch -> 0x8f66333c
                            // 0x8f66333c
                            dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                            v21 = 40;
                            v9 = v21;
                            v22 = a1;
                            v23 = v22 + v21;
                            v12 = v23;
                            v3 = 128;
                            v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                            result = v18;
                            // branch -> 0x8f663300
                            goto lab_0x8f663300_6;
                        }
                        case 240: {
                            // if_8f6632e8_0_true
                            // branch -> 0x8f66333c
                            // 0x8f66333c
                            dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                            v21 = 98;
                            v9 = v21;
                            v22 = a1;
                            v23 = v22 + v21;
                            v12 = v23;
                            v3 = 128;
                            v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                            result = v18;
                            // branch -> 0x8f663300
                            goto lab_0x8f663300_6;
                        }
                    }
                  lab_0x8f663300_7:
                    // 0x8f663300
                    v16 = v1;
                    if (v16 == 0) {
                        goto lab_after_if_8f663308_0_10;
                    }
                    goto lab_if_8f663304_0_true_10;
                } else {
                    // 0x8f6632cc
                    if (v19 == 15) {
                        // if_8f6632d0_0_true
                        // branch -> 0x8f66333c
                        // 0x8f66333c
                        dbval_debug_print2((int32_t)"dbval_validate_datablock - Check DB Signature", v9, v12);
                        v21 = 68;
                        v9 = v21;
                        v22 = a1;
                        v23 = v22 + v21;
                        v12 = v23;
                        v3 = 128;
                        v18 = dbval_validate_signature(v22, v21, v23, 128, a2, 0, 0, 0, v13, v2, 0, g49, g50, g51, g52, g53, g54, g46, g47, g43, v5, 0);
                        result = v18;
                        // branch -> 0x8f663300
                        goto lab_0x8f663300_7;
                    }
                    // 0x8f663300
                    v16 = v1;
                    if (v16 == 0) {
                        goto lab_after_if_8f663308_0_10;
                    }
                    goto lab_if_8f663304_0_true_10;
                }
            }
        } else {
            result = 85;
        }
    }
    // 0x8f663300
    v16 = v1;
    if (v16 == 0) {
        goto lab_after_if_8f663308_0_10;
    }
    goto lab_if_8f663304_0_true_10;
}

// --------------- Statically Linked Functions ----------------

// ulldiv_t __aeabi_uldivmod(unsigned long long a, unsigned long long b);
// void __stack_chk_fail(void);
// void free(void * ptr);
// void * malloc(size_t size);
// int memcmp(const void * s1, const void * s2, size_t n);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// int strcmp(const char * s1, const char * s2);

// --------------- Instruction-Idiom Functions ----------------

// int32_t llvm_bswap_i32(int32_t a1);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 30
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 19:49:15
