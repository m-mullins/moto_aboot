//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <ctype.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t arch_early_init(void);
int32_t boot_handler(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t boot_linux(int32_t (*a1)(int32_t, int32_t, int32_t), int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t disable_charger_gone_irq(int32_t a1, int32_t a2, int32_t a3);
int32_t enable_charger_gone_irq(int32_t a1, int32_t a2);
void function_8f64b730(void);
void function_8f64b7f0(char * str, char * delim, int32_t a3);
int32_t hab_policy_init(void);
int32_t init_barcodes(int32_t a1, int32_t a2, int32_t a3);
int32_t init_panels(void);
int32_t is_like_hab_signature(char * a1, int32_t a2, int32_t a3);
int32_t is_warranty_void(int32_t a1);
int32_t load_and_validate_logo(void);
int32_t LZ4_decompress_safe(char * a1, char * a2, int32_t a3, int32_t a4, int32_t a5);
int32_t LZ4_decompress_safe_withPrefix64k(char * a1, char * a2, int32_t a3, int32_t a4, int32_t a5);
int32_t mcs_habp_rsa_crt_core(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6, int32_t a7);
int32_t mcs_habp_rsa_crt_med(int32_t a1, int32_t a2, int32_t a3);
int32_t mipi_mot_get_manufacture_id(int32_t * a1, int32_t a2, int32_t a3);
int32_t mipi_mot_get_supplier_id(int32_t * a1, int32_t a2, int32_t a3);
char * mmc_sd_set_bus_width(char * a1, int32_t * a2, int32_t a3);
char * mmc_sd_set_hs(char * a1);
int32_t move_to_verified(int32_t a1, int32_t a2, int32_t a3);
int32_t qup_i2c_sec_init(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t qup_i2c_xfer(int32_t a1);
int32_t radio_from_utag(int32_t a1, int32_t a2, int32_t a3);
char * restore_secure_cfg(int32_t a1, int32_t a2);
int32_t scm_init(int32_t a1);
int32_t screen_manager_init(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t show(char * a1, int32_t a2, int32_t a3);
int32_t target_hwrev(void);

// --------------------- Global Variables ---------------------

int32_t g45 = 0; // LR
int32_t g46 = 0; // R0
int32_t g47 = 0; // R1
int32_t g48 = 0; // R11
int32_t g49 = 0; // R12
int32_t g50 = 0; // R2
int32_t g51 = 0; // R3
int32_t g52 = 0; // R4
int32_t g53 = 0; // R5
int32_t g54 = 0; // R6
int32_t g55 = 0; // R7
int32_t g56 = 0; // R8
int32_t g57 = 0; // R9
int32_t g1 = -0x15fffffa; // 0x8f600000
int32_t g2 = -0x1a60cef8; // 0x8f612228
int32_t g3 = -0x1a60ceec; // 0x8f6383f0
int32_t g4 = -0x16d2bfc9; // 0x8f6387c0
int32_t g5 = -0x16d2bc09; // 0x8f638ab0
int32_t g6 = -0x1a60ff98; // 0x8f638b94
int32_t g7 = -0x16d2bfc9; // 0x8f64587c
char * g8 = "\xff\xff\xff\xff\x6c\x6f\x61\x64\x5f\x61\x6e\x64\x5f\x76\x61\x6c\x69\x64\x61\x74\x65\x5f\x6b\x65\x72\x6e\x65\x6c\x5f\x69\x6d\x61\x67\x65"; // 0x8f6826be
int32_t g9 = 0x65440030; // 0x8f69c66f
int32_t g10 = 0; // 0x8f6a3f38
int32_t g11 = 1; // 0x8f6ac0f0
int32_t g12 = -0x709c73f8; // 0x8f6ac374
int32_t g13 = 0xffff; // 0x8f6acae4
int32_t g14 = 4; // 0x8f6acaf4
int32_t g15 = 0xffff; // 0x8f6acb2c
int32_t g16 = 4; // 0x8f6acb84
int32_t g17 = 0; // 0x8f6b0048
int32_t g18 = 0; // 0x8f6b004c
int32_t g19 = 0; // 0x8f6b0074
int32_t g20 = 0; // 0x8f6b0078
int32_t g21 = 0; // 0x8f6b015c
int32_t g22 = 0; // 0x8f6b1608
int32_t g23 = 0; // 0x8f6b7cc0
int32_t g24 = 0; // 0x8f6c0000
int32_t g25 = 0; // 0x8f6c02aa
int32_t g26 = 0; // 0x8f6c02ba
int32_t g27 = 0; // 0x8f6c02ca
int32_t g28 = 0; // 0x8f6c02e0
int32_t g29 = 0; // 0x8f6e082c
char * g30; // 0x8f6e0849
int32_t g31 = 0; // 0x8f6e0854
int32_t g32 = 0; // 0x8f6e0858
int32_t g33 = 0; // 0x8f6e085c
int32_t g34 = 0; // 0x8f6e0878
int32_t g35 = 0; // 0x8f6e0894
int32_t g36 = 0; // 0x8f6e08b0
int32_t g37 = 0; // 0x8f6e08b4
char ** g38 = NULL; // 0x8f6e0bf8
int32_t g39 = 0; // 0x8f710c30
int32_t g40 = 0; // 0x8f710c34
int16_t * g41 = NULL; // 0x8f7112f4
int32_t g42 = 0; // 0x8f7114b8
int32_t g43 = 0; // 0x8f71302c
int32_t g44 = 0; // 0x8f713044

// ------------------------ Functions -------------------------

// Address range: 0x8f62067c - 0x8f620853
int32_t boot_linux(int32_t (*a1)(int32_t, int32_t, int32_t), int32_t a2, int32_t a3, int32_t a4, int32_t a5) {
    int32_t v1 = (int32_t)a1;
    int32_t v2 = g52; // 0x8f620680
    int32_t v3 = g53; // 0x8f620680
    int32_t v4 = g54; // 0x8f620680
    int32_t v5 = g55; // 0x8f620680
    int32_t v6 = g56; // 0x8f620680
    int32_t v7 = g57; // 0x8f620680
    int32_t v8 = 0; // 0x8f620680
    int32_t v9 = g48; // 0x8f620680
    int32_t v10 = g45; // 0x8f620680
    g48 = v10;
    int16_t * v11 = g41;
    int32_t v12 = (int32_t)v11;
    g55 = v1;
    int32_t v13;
    g57 = v13;
    int32_t v14 = platform_get_virt_to_phys_mapping(v1, a2, a3, v12); // 0x8f6206b0
    g54 = v1;
    int32_t v15 = platform_get_virt_to_phys_mapping(a2, a2, v14, v12); // 0x8f6206bc
    g52 = a2;
    int32_t v16 = platform_get_virt_to_phys_mapping(a5, a2, v15, v12); // 0x8f6206c8
    g56 = a5;
    int32_t v17;
    int32_t v18;
    char * v19 = update_cmdline(a3, a2, v16, v12, v18, v17, (int32_t)&g41, a4, 0, v12, 0, v2, v3, v4, v5, v6, v7, v8, v9, v10, a5, v13); // 0x8f6206d8
    int32_t v20 = (int32_t)v19; // R10
    print_log(1, (int32_t)"Updating device tree: start\n", v16, v12, v18, v17, (int32_t)&g41, a4, 0, v12, 0, v2, v3);
    int32_t v21 = g56; // 0x8f6206f4
    int32_t v22 = v21; // R2
    int32_t v23 = g57; // 0x8f6206f8
    int32_t v24 = v23; // R3
    int32_t v25 = update_device_tree(a2, v20, v21, v23, v18, v17, (int32_t)&g41, a4, 0, v12, 0, v2, v3, v4, v5, v6, v7, v8, v9, v10, a5, v13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0); // 0x8f6206fc
    g49 = (int32_t)&g41;
    g53 = (int32_t)&g41;
    int32_t v26 = v18; // 0x8f6207c81
    if (v25 != 0) {
        // 0x8f620710
        print_log(-1, (int32_t)"ERROR: Updating Device Tree Failed \n", v22, v24, v18, v17, (int32_t)&g41, a4, 0, v12, 0, v2, v3);
        v22 = (int32_t)"app/mbm/linux_boot.c";
        v24 = (int32_t)&g9 & -0x10000 | 886;
        _panic(g48, (int32_t)"ASSERT FAILED at (%s:%d): %s\n", (int32_t)"app/mbm/linux_boot.c", (int32_t)&g9 & -0x10000 | 886, (int32_t)&g9, v17, (int32_t)&g41);
        v26 = &g9;
        // branch -> 0x8f620738
    }
    // 0x8f620738
    print_log(1, (int32_t)"Updating device tree: done\n", v22, v24, v26, v17, (int32_t)&g41, a4, 0, v12, 0, v2, v3);
    free((char *)v20);
    int32_t v27 = g54; // 0x8f620754
    v22 = v27;
    int32_t v28 = g56; // 0x8f620758
    int32_t v29 = g57; // 0x8f62075c
    int32_t v30 = g52; // 0x8f620760
    int32_t v31 = print_log(1, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v27, v28, v29, v30, (int32_t)&g41, a4, 0, v12, 0, v2, v3); // 0x8f620764
    int32_t v32 = sod_ramdump_enabled((char *)v31, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28); // 0x8f620768
    int32_t v33; // 0x8f6207b4
    int32_t v34; // 0x8f620794
    int32_t v35; // 0x8f6207bc
    int32_t v36; // 0x8f6207c8
    int32_t v37; // 0x8f620790
    int16_t * v38;
    int32_t v39;
    int32_t v40; // 0x8f6207a0
    int32_t v41; // 0x8f6207cc
    int32_t v42; // 0x8f6207f0
    int32_t v43; // 0x8f620800
    if (v32 == 0) {
        // 0x8f620790
        v37 = flush_logs(0, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28, v29, v30, (int32_t)&g41, a4);
        v34 = target_uninit(v32, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v37, v28, v29, v30, (int32_t)&g41);
        v39 = g11;
        v40 = v39 + 1;
        g11 = v40;
        v33 = v34;
        if (v39 == 0) {
            // 0x8f6207b0
            v33 = function_8f619448(v34);
            // branch -> 0x8f6207b4
        }
        // 0x8f6207b4
        platform_uninit((char *)v33, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40);
        v35 = function_8f6191cc(3, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40, v29, v30, (int32_t)&g41, a4, 0, v12, 0, v2, v3, v4, v5, v6, v7);
        arch_disable_mmu(v35, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40);
        v36 = bs_set_timestamp(1, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40, v29, v30, (int32_t)&g41, a4);
        g46 = v36;
        v41 = g55;
        g51 = 0x644d5241;
        if (*(int32_t *)(v41 + 56) == 0x644d5241) {
            // 0x8f6207dc
            v38 = g41;
            if (v11 == v38) {
                // 0x8f6207ec
                v42 = g52;
                g52 = v2;
                g54 = v4;
                g55 = v5;
                return scm_elexec_call(v41, v42, v12, (int32_t)v38, v2, v3, v4);
            }
        } else {
            // 0x8f620800
            v43 = g52;
            g50 = v43;
            g46 = 0;
            g47 = a4;
            g45 = -0x709df7f0;
            ((int32_t (*)(int32_t, int32_t, int32_t))g54)(0, a4, v43);
            if (v11 == g41) {
                // 0x8f620824
                g52 = v2;
                g54 = v4;
                g55 = v5;
                return g46;
            }
        }
        // 0x8f620820
        __stack_chk_fail();
        // branch -> 0x8f620824
        // 0x8f620824
        g52 = v2;
        g54 = v4;
        g55 = v5;
        return g46;
    }
    int32_t v44 = sod_dump_to_sd(v32, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28, v29, v30, (int32_t)&g41, a4); // 0x8f620774
    int32_t v45 = v44; // R0
    int32_t v46; // 0x8f62078c
    if (v44 != 0) {
        // 0x8f620780
        confession_clear(v44, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28, v29, v30, (int32_t)&g41);
        int32_t v47 = confession_redirect_to_logger(1, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28); // 0x8f620788
        v22 = v47;
        v46 = confession_gather(1, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v47, v28, v29, v30, (int32_t)&g41);
        v45 = v46;
        // branch -> 0x8f620790
    } else {
        v46 = 0;
    }
    // 0x8f620790
    v37 = flush_logs(v46, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v22, v28, v29, v30, (int32_t)&g41, a4);
    v34 = target_uninit(v45, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", v37, v28, v29, v30, (int32_t)&g41);
    v39 = g11;
    v40 = v39 + 1;
    g11 = v40;
    v33 = v34;
    if (v39 == 0) {
        // 0x8f6207b0
        v33 = function_8f619448(v34);
        // branch -> 0x8f6207b4
    }
    // 0x8f6207b4
    platform_uninit((char *)v33, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40);
    v35 = function_8f6191cc(3, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40, v29, v30, (int32_t)&g41, a4, 0, v12, 0, v2, v3, v4, v5, v6, v7);
    arch_disable_mmu(v35, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40);
    v36 = bs_set_timestamp(1, (int32_t)"Booting linux @ %p, ramdisk @ %p (%d), tags/device tree @ %p\n", (int32_t)&g11, v40, v29, v30, (int32_t)&g41, a4);
    g46 = v36;
    v41 = g55;
    g51 = 0x644d5241;
    if (*(int32_t *)(v41 + 56) == 0x644d5241) {
        // 0x8f6207dc
        v38 = g41;
        if (v11 == v38) {
            // 0x8f6207ec
            v42 = g52;
            g52 = v2;
            g54 = v4;
            g55 = v5;
            return scm_elexec_call(v41, v42, v12, (int32_t)v38, v2, v3, v4);
        }
    } else {
        // 0x8f620800
        v43 = g52;
        g50 = v43;
        g46 = 0;
        g47 = a4;
        g45 = -0x709df7f0;
        ((int32_t (*)(int32_t, int32_t, int32_t))g54)(0, a4, v43);
        if (v11 == g41) {
            // 0x8f620824
            g52 = v2;
            g54 = v4;
            g55 = v5;
            return g46;
        }
    }
    // 0x8f620820
    __stack_chk_fail();
    // branch -> 0x8f620824
    // 0x8f620824
    g52 = v2;
    g54 = v4;
    g55 = v5;
    return g46;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// long int atol(const char * nptr);
// void free(void * ptr);
// int isdigit(int c);
// int isxdigit(int c);
// int memcmp(const void * s1, const void * s2, size_t n);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// void * memset(void * s, int c, size_t n);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// int strcmp(const char * s1, const char * s2);
// size_t strlen(const char * s);
// int strncmp(const char * s1, const char * s2, size_t n);
// char * strtok_r(char * restrict s, const char * restrict delim, char ** restrict save_ptr);
// int tolower(int c);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 30
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 19:19:08
