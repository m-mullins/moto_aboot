//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t cache_state_to_sp(void);
int32_t get_boot_component_version(int32_t a1);
int32_t get_policy_executor(char * a1);
int32_t get_primary_gpt_partition(int32_t a1, int32_t a2, int32_t a3);
int32_t hab_add_verified_blocks(char * a1, int32_t a2, int32_t a3);
int32_t hab_code_hash(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t hab_code_sig_verification(int32_t a1, int32_t a2, int32_t a3, uint32_t a4);
int32_t hab_parse_certificate(int32_t a1, char * a2, int32_t * a3, int16_t * a4, int32_t * a5);
int32_t hab_rsa_verification(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t hab_skip_identifier(int32_t a1);
int32_t hab_sw_rsa(char * str, char * str2, uint32_t n, int32_t a4, uint32_t a5);
int32_t locking_phone(int32_t a1, int32_t a2, int32_t a3);
int32_t mcs_X509Certificate_decodeExtension(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t mcs_X509Certificate_extractAlgorithm(int32_t a1, int32_t a2, int32_t * a3, int32_t a4);
int32_t mcs_X509Certificate_extractNames(int32_t a1, int32_t a2, int32_t * a3, int16_t * a4);
int32_t mcs_X509Certificate_getExtensions(int32_t a1, int32_t * a2, int16_t * a3);
int32_t mcs_X509Certificate_removePadding(int32_t a1, int32_t a2);
int32_t set_current_secure_state(char a1, int32_t a2, int32_t a3);
int32_t unlock_phone(int32_t a1, int32_t a2, int32_t a3);
int32_t validate_sparse_partition(int32_t a1, int32_t a2);
int32_t write_protect_on_partition(int32_t a1, int32_t a2);
int32_t write_protect_was_enabled(char * a1, int32_t a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g54 = 0; // LR
int32_t g55 = 0; // R0
int32_t g56 = 0; // R1
int32_t g57 = 0; // R10
int32_t g58 = 0; // R11
int32_t g59 = 0; // R2
int32_t g60 = 0; // R3
int32_t g61 = 0; // R4
int32_t g62 = 0; // R5
int32_t g63 = 0; // R6
int32_t g64 = 0; // R7
int32_t g65 = 0; // R8
int32_t g66 = 0; // R9
int32_t g1 = 1; // 0x8f6b0044
int32_t g2 = 0; // 0x8f6b0070
char g3 = 0; // 0x8f70dad8
int32_t g4 = 0; // 0x8f70dcf4
int32_t g5 = 0; // 0x8f70ddf8
int32_t g6 = 0; // 0x8f70ddfc
int32_t g7 = 0; // 0x8f70dff4
int32_t g8 = 0; // 0x8f70dff8
char * g9; // 0x8f70dffc
int32_t g10 = 0; // 0x8f70e3fc
char g11 = 0; // 0x8f70e500
char g12 = 0; // 0x8f70e604
char * g13; // 0x8f70e708
char g14 = 0; // 0x8f70e709
char g15 = 0; // 0x8f70e70a
char g16 = 0; // 0x8f70e70b
char g17 = 0; // 0x8f70e70c
char g18 = 0; // 0x8f70e70d
int32_t g19 = 0; // 0x8f70e718
int32_t g20 = 0; // 0x8f70e719
int32_t g21 = 0; // 0x8f70e71a
int32_t g22 = 0; // 0x8f70e71b
char g23 = 0; // 0x8f70e71c
char g24 = 0; // 0x8f70e71d
char g25 = 0; // 0x8f70e71e
char g26 = 0; // 0x8f70e71f
char * g27; // 0x8f70f724
int32_t g28 = 0; // 0x8f70f725
int32_t g29 = 0; // 0x8f70f745
int32_t g30 = 0; // 0x8f70f746
int32_t g31 = 0; // 0x8f70f747
int32_t g32 = 0; // 0x8f70f748
int32_t g33 = 0; // 0x8f70f749
int32_t g34 = 0; // 0x8f70f74a
int32_t g35 = 0; // 0x8f70f74b
int32_t g36 = 0; // 0x8f70f74c
int32_t g37 = 0; // 0x8f70f74d
int32_t g38 = 0; // 0x8f70f74e
int32_t g39 = 0; // 0x8f70f74f
int32_t g40 = 0; // 0x8f70f750
int32_t g41 = 0; // 0x8f70f751
int32_t g42 = 0; // 0x8f70f752
int32_t g43 = 0; // 0x8f70f753
int32_t g44 = 0; // 0x8f70f754
char g45 = 0; // 0x8f70f755
char g46 = 0; // 0x8f70f756
char * g47; // 0x8f70f75d
char * g48; // 0x8f710a25
int32_t g49 = 0; // 0x8f7112f4
int32_t g50 = 0; // 0x8f7129dc
int32_t g51 = 0; // 0x8f712e1c
int32_t g52 = 0; // 0x8f712f2c
int32_t g53 = 0; // 0x8f71302c

// ------------------------ Functions -------------------------

// Address range: 0x8f670158 - 0x8f67046b
// Used cryptographic patterns:
//  - PKCS_DigestDecoration_SHA256 (8-bit, little endian)
//  - PKCS_DigestDecoration_SHA384 (8-bit, little endian)
//  - SSH_RSA_id_sha1_OBJ_ID__oiw_14__secsig_3__algorithms_2__26 (8-bit, little endian)
int32_t hab_rsa_verification(int32_t a1, int32_t a2, int32_t a3, int32_t a4) {
    int32_t v1 = g62; // 0x8f670158
    g65 = a3;
    g66 = &g49;
    g57 = a4;
    g64 = a2;
    int32_t v2 = 0x10000 * a1 / 0x10000; // bp-346
    int32_t v3 = g49;
    int32_t v4;
    g62 = v4;
    int32_t v5 = 0; // bp-344
    int32_t v6; // 0x8f6701e0
    switch ((int16_t)a1) {
        default: {
            // if_8f6701cc_0_true
            v6 = 255;
            // branch -> 0x8f6701d0
            break;
        }
        case 17: {
            // if_8f670198_0_true
            v6 = 1;
            // branch -> 0x8f6701d0
            break;
        }
        case 193: {
            // if_8f6701a4_0_true
            v6 = 65;
            // branch -> 0x8f6701d0
            break;
        }
        case 18: {
            // if_8f6701b0_0_true
            v6 = 2;
            // branch -> 0x8f6701d0
            break;
        }
        case 50: {
            // if_8f6701bc_0_true
            v6 = 98;
            // branch -> 0x8f6701d0
            break;
        }
        case 19: {
            // if_8f6701c8_0_true
            v6 = 3;
            // branch -> 0x8f6701d0
            break;
        }
    }
    // 0x8f6701d0
    int32_t v7;
    g61 = &v7;
    v2 = v6;
    int32_t v8;
    hab_hash_decision(a2, (int32_t)&v5, (int32_t)&v2, v6, v8);
    int32_t v9 = g62; // 0x8f6701ec
    int32_t v10 = (int32_t)*(int16_t *)(v9 + 10); // 0x8f6701ec
    g63 = v10;
    int32_t v11 = (int32_t)*(int16_t *)(v9 + 8); // 0x8f6701f0
    int32_t v12 = g61; // 0x8f6701f8
    int32_t v13 = *(int32_t *)(v9 + 4); // 0x8f670208
    int32_t v14; // 0x8f670334_0
    int32_t v15; // 0x8f670338
    int32_t result;
    int32_t str;
    int32_t v16;
    int32_t v17;
    if (hab_sw_rsa((char *)g57, (char *)v13, v10, v9, v11) == 240) {
        // 0x8f670220
        if ((0x1000000 * v7 || 0xffffff) < 0x1ffffff) {
            // 0x8f67022c
            int32_t v18;
            if (0x1000000 * v18 == 0x1000000) {
                // if_8f670234_0_true
                g62 = 2;
                if (g63 <= 2) {
                    // 0x8f670244
                    // branch -> 0x8f670218
                }
                // 0x8f670218
                v16 = g49;
                int32_t v19 = v16; // R3
                if (v3 == v16) {
                    // 0x8f670450
                    g62 = v1;
                    return 53;
                }
                // 0x8f67032c
                v14 = &str;
                // branch -> 0x8f67032c
                while (true) {
                    // 0x8f67032c
                    __stack_chk_fail();
                    v17 = v19;
                    v15 = hab_sahara_hash(g64, v17, v14, v17, v11, v12, 0, 0, v5, str, 0, 0, 0, 0, 0);
                    int32_t v20;
                    if (v15 == 240) {
                      lab_0x8f6702b0:
                        // 0x8f6702b0
                        hab_rehash(v2 % 0x10000, g65, v14, -314, v11, v12, 0, 0, v5, str, 0, 0);
                        int32_t n = g63 == 20 ? 0 : 15;
                        g64 = n;
                        if (g63 == n + 20) {
                            // 0x8f6702e0
                            if (memcmp((char *)(g61 + g62), "\x30\x21\x30\x09\x06\x05\x2b\x0e\x03\x02\x1a\x05\x00\x04\x14", n) == 0) {
                                // 0x8f670308
                                if (memcmp((char *)(g64 + g62 + g61), (char *)&str, 20) == 0) {
                                    // 0x8f670318
                                    v20 = g49;
                                    v19 = v20;
                                    if (v3 == v20) {
                                        result = 240;
                                        // break (via goto) -> 0x8f670450
                                        goto lab_0x8f670450_3;
                                    }
                                    // continue -> 0x8f67032c
                                    continue;
                                }
                            }
                        }
                        int32_t v21 = g49;
                        v19 = v21;
                        if (v3 == v21) {
                            result = 53;
                            // break (via goto) -> 0x8f670450
                            goto lab_0x8f670450_3;
                        }
                        // continue -> 0x8f67032c
                        continue;
                    } else {
                      lab_0x8f670318:
                        // 0x8f670318
                        v20 = g49;
                        v19 = v20;
                        if (v3 == v20) {
                            result = 142;
                            // break (via goto) -> 0x8f670450
                            goto lab_0x8f670450_3;
                        }
                        // continue -> 0x8f67032c
                        continue;
                    }
                }
            }
        }
    }
    // 0x8f670218
    v16 = g49;
    if (v3 == v16) {
        result = 53;
      lab_0x8f670450_3:
        // 0x8f670450
        g62 = v1;
        return result;
    }
    // 0x8f67032c
    v14 = &str;
    // branch -> 0x8f67032c
    while (true) {
        // 0x8f67032c
        __stack_chk_fail();
        v17 = v16;
        v15 = hab_sahara_hash(g64, v17, v14, v17, v11, v12, 0, 0, v5, str, 0, 0, 0, 0, 0);
        if (v15 == 240) {
            goto lab_0x8f6702b0;
        }
        goto lab_0x8f670318;
    }
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// void free(void * ptr);
// void * malloc(size_t size);
// int memcmp(const void * s1, const void * s2, size_t n);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// void * memset(void * s, int c, size_t n);
// int strcmp(const char * s1, const char * s2);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 22
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:53:28
