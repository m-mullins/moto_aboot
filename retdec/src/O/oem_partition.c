//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------------ Structures ------------------------

struct _TYPEDEF_lldiv_t {
    int64_t e0;
    int64_t e1;
};

// ------------------- Function Prototypes --------------------

int32_t config_cmd_allowed(char * a1, int32_t a2);
int32_t confirm_unlock(int32_t a1, int32_t a2);
int32_t handle_fboot_oem_command_lock(int32_t a1, int32_t a2);
int32_t hash_partition(int32_t a1, int32_t a2, int32_t a3);
int32_t list_partition(int32_t a1);
int32_t list_utag(char * a1);
int32_t oem_blankflash(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t oem_partition(int32_t a1, int32_t a2);
int32_t oem_partitions(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_ramdump_usage(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_show_screen(int32_t a1, int32_t a2);
int32_t send_emmc_data(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t test_bool(char * str, int32_t a2, int32_t a3);
int32_t type_atoi_9(char * str, int32_t a2);
int32_t type_itoa_8(int32_t a1, int32_t a2);
int32_t unset_utag(int32_t a1, int32_t a2, int32_t a3);
int32_t validate_device(int32_t a1, char * a2);

// --------------------- Global Variables ---------------------

int32_t g7 = 0; // R1
int32_t g8 = 0; // R2
int32_t g9 = 0; // R3
int32_t g10 = 0; // R4
int32_t g11 = 0; // R5
int32_t g12 = 0; // R6
int32_t g1 = -0x16d2bc09; // 0x8f638ab0
char * g2[6] = {
    "fsg-id",
    "battery",
    "carrier",
    "bootmode",
    "enable_dump_gpt",
    "num-sims"
}; // 0x8f688974
int32_t g3 = 0x746e6300; // 0x8f6a4e20
int64_t g4 = 0; // 0x8f7112f4
int32_t g5 = 0; // 0x8f711514
char * g6; // 0x8f711530

// ------------------------ Functions -------------------------

// Address range: 0x8f6267f4 - 0x8f626cdf
int32_t oem_partition(int32_t a1, int32_t a2) {
    struct _TYPEDEF_lldiv_t v1; // 0x8f626bc4
    // 0x8f6267f4
    int32_t v2;
    char * v3 = (char *)v2;
    int32_t v4;
    char * v5 = (char *)v4;
    g7 = a2;
    g10 = a1 - 1;
    int32_t v6 = g4;
    int32_t v7;
    int32_t v8;
    int32_t v9;
    if (a1 == 1) {
        int32_t v10 = g10; // 0x8f62681829
        if (v10 < get_partition_count(1)) {
            // 0x8f626850
            // branch -> 0x8f626c5c
            // 0x8f626c5c
            if (v6 != (int32_t)g4) {
                // 0x8f626c6c
                __stack_chk_fail();
                // branch -> 0x8f626c70
            }
            // 0x8f626c70
            return 1;
        }
        g10 = v10 + 1;
        int32_t v11 = list_partition(partition_get_name(v10, a2, g8, v6, v9, v2, v8, v4, 0, v7)); // 0x8f62682c
        while (g10 >= get_partition_count(v11)) {
            // 0x8f626820
            v10 = g10;
            g10 = v10 + 1;
            v11 = list_partition(partition_get_name(v10, a2, g8, v6, v9, v2, v8, v4, 0, v7));
            // continue -> 0x8f626820
        }
        // 0x8f626850
        // branch -> 0x8f626c5c
        // 0x8f626c5c
        if (v6 != (int32_t)g4) {
            // 0x8f626c6c
            __stack_chk_fail();
            // branch -> 0x8f626c70
        }
        // 0x8f626c70
        return 1;
    }
    int32_t str = *(int32_t *)(a2 + 4); // 0x8f626834
    g11 = str;
    int32_t v12; // R0
    int32_t result3; // 0x8f626c74_2
    int32_t v13; // bp+258
    if (strcmp((char *)str, "help") == 0) {
        // 0x8f62684c
        oem_partition_usage(0, (int32_t)"help", g8, v6);
        // branch -> 0x8f626850
        // 0x8f626850
        v12 = 1;
        v13 = 1;
        // branch -> 0x8f626c5c
    } else {
        // 0x8f626858
        if (strcmp((char *)g11, "dump") == 0) {
            // 0x8f62686c
            require_mot_fastboot(0, (int32_t)"dump", g8, v6);
            // branch -> 0x8f626b7c
        } else {
            // 0x8f626874
            g7 = (int32_t)"moto-dump";
            if (strcmp((char *)g11, "moto-dump") != 0) {
                // 0x8f626bf8
                g7 = (int32_t)"md5";
                int32_t strcmp_rc = strcmp((char *)g11, "md5"); // 0x8f626c00
                int32_t v14 = a2 + 4; // 0x8f626c04
                g8 = strcmp_rc;
                int32_t result; // 0x8f626c4c
                if (strcmp_rc == 0) {
                    // 0x8f626c10
                    if (g10 > 1) {
                        // if_8f626c14_0_true
                        // branch -> 0x8f626c4c
                        // 0x8f626c4c
                        result = hash_partition(g10, v14, 0);
                        // branch -> 0x8f626c5c
                        // 0x8f626c5c
                        if (v6 != (int32_t)g4) {
                            // 0x8f626c6c
                            __stack_chk_fail();
                            // branch -> 0x8f626c70
                        }
                        // 0x8f626c70
                        return result;
                    }
                    // 0x8f626890
                    oem_partition_usage(0, g7, g8, v6);
                    // branch -> 0x8f626b7c
                    // 0x8f626b7c
                    // branch -> 0x8f626c5c
                    // 0x8f626c5c
                    if (v6 != (int32_t)g4) {
                        // 0x8f626c6c
                        __stack_chk_fail();
                        // branch -> 0x8f626c70
                    }
                    // 0x8f626c70
                    return 3;
                }
                // 0x8f626c24
                g7 = (int32_t)"sha256";
                if (strcmp((char *)g11, "sha256") != 0) {
                    int32_t result2 = list_partition(g11); // 0x8f626c58
                    // branch -> 0x8f626c5c
                    // 0x8f626c5c
                    if (v6 != (int32_t)g4) {
                        // 0x8f626c6c
                        __stack_chk_fail();
                        // branch -> 0x8f626c70
                    }
                    // 0x8f626c70
                    return result2;
                }
                // 0x8f626c38
                if (g10 < 2) {
                    // 0x8f626890
                    oem_partition_usage(0, g7, g8, v6);
                    // branch -> 0x8f626b7c
                    // 0x8f626b7c
                    v12 = 3;
                    v13 = 3;
                    // branch -> 0x8f626c5c
                } else {
                    // 0x8f626c40
                    // branch -> 0x8f626c4c
                    // 0x8f626c4c
                    result = hash_partition(g10, v14, 1);
                    v12 = result;
                    v13 = result;
                    // branch -> 0x8f626c5c
                }
                // 0x8f626c5c
                if (v6 != (int32_t)g4) {
                    // 0x8f626c6c
                    __stack_chk_fail();
                    result3 = v12;
                    // branch -> 0x8f626c70
                } else {
                    result3 = v13;
                }
                // 0x8f626c70
                return result3;
            }
            // 0x8f626888
            if (g10 > 1) {
                int32_t str2 = *(int32_t *)(a2 + 8); // 0x8f626898
                int32_t v15 = partition_get_index(str2, g7, g8, v6, v9, v2); // 0x8f6268a0
                g9 = 0;
                int32_t v16 = 0;
                int32_t v17 = 0;
                int32_t v18 = v15;
                int32_t v19; // 0x8f626a24
                int32_t v20;
                int32_t v21; // 0x8f626bf0
                int32_t v22; // 0x8f626bf0
                int32_t v23; // 0x8f626988_0
                int32_t v24; // 0x8f626a54_0
                int32_t v25; // 0x8f626a58_0
                int32_t strcmp_rc2; // 0x8f626920
                uint32_t strcmp_rc3; // 0x8f626938
                int32_t v26; // 0x8f626968
                int32_t v27; // 0x8f626990
                int32_t strcmp_rc4; // 0x8f6269d0
                int32_t v28; // 0x8f626a24
                int32_t v29; // 0x8f626a38
                int32_t v30; // 0x8f626a5c
                int32_t v31; // 0x8f626b98
                int32_t v32; // R1
                int32_t v33; // R2
                int32_t v34; // R3
                int32_t v35; // R7
                int32_t v36;
                int32_t v37;
                int32_t v38;
                int32_t v39;
                int32_t v40;
                char * v41;
                char * v42;
                bool v43; // 0x8f626abc
                int32_t v44; // 0x8f626a8c
                uint32_t v45; // 0x8f626ba8
                int32_t v46; // 0x8f626a8c
                bool v47; // 0x8f626abc
                int32_t v48; // 0x8f6269c0
                int32_t v49; // 0x8f626ae0
                int32_t v50; // 0x8f626ae4
                int32_t v51; // 0x8f626b1c
                int32_t v52; // 0x8f626b84
                int32_t v53; // 0x8f626b88
                int32_t v54; // 0x8f626ba0
                uint32_t v55; // 0x8f626a74
                uint32_t v56; // 0x8f626a7c
                int32_t v57; // 0x8f626ac0
                int32_t v58; // 0x8f626b20
                int32_t v59; // 0x8f626b2c
                uint32_t v60; // 0x8f626b38
                int32_t v61; // 0x8f626bc0
                int32_t v62; // 0x8f62699c
                int32_t v63; // 0x8f626a9c
                uint32_t v64; // 0x8f626aa4
                int32_t v65; // 0x8f626b38
                int32_t v66; // 0x8f626bbc
                int32_t v67; // 0x8f626b20
                int32_t v68; // 0x8f626b2c
                int32_t v69;
                int32_t v70; // 0x8f626aa8
                int32_t v71; // 0x8f626b40
                if (g10 == 2) {
                    // 0x8f6268fc
                    g12 = 0;
                    v35 = 0;
                    g10 = 0;
                    g11 = 0;
                    // branch -> 0x8f626918
                    // 0x8f626918
                    v32 = (int32_t)"main_gpt";
                    strcmp_rc2 = strcmp((char *)str2, "main_gpt");
                    v38 = 1;
                    if (strcmp_rc2 != 0) {
                        // 0x8f626930
                        v32 = (int32_t)"backup_gpt";
                        strcmp_rc3 = strcmp((char *)str2, "backup_gpt");
                        v38 = strcmp_rc3 > 1 ? 0 : 1 - strcmp_rc3;
                        // branch -> 0x8f626944
                    }
                    // 0x8f626944
                    v29 = is_validation_enabled((char *)v38, v32, g8, g9);
                    if (v38 == 0) {
                        // 0x8f626a38
                        if (v29 == 0) {
                            // 0x8f626a4c
                            v24 = &v16;
                            g8 = v24;
                            v25 = &v17;
                            g9 = v25;
                            v30 = ptn_stat(str2, (int32_t)&v18, v24, v25, v9, v2, v8, v4, 0, v7, 0, v18, v16, 0, v17, 0, 0, v6);
                            if (v30 == 0) {
                                // if_8f626a64_0_true
                                // branch -> 0x8f626afc
                                // 0x8f626afc
                                fboot_info((int32_t)"INFO", (int32_t)"partition: %s not found", str2, g9, v9, v2, v8, v4, 0, v7, 0);
                                // branch -> 0x8f626b7c
                            } else {
                                // 0x8f626a74
                                v55 = v17;
                                if (v35 == 0) {
                                    // after_if_8f626a7c_0
                                    v56 = g12;
                                    if (v55 <= v56) {
                                        // after_if_8f626a84_0
                                        // branch -> 0x8f626b78
                                        // 0x8f626b78
                                        fboot_info((int32_t)"INFO", (int32_t)"offset out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                        // branch -> 0x8f626b7c
                                        // 0x8f626b7c
                                        // branch -> 0x8f626c5c
                                        // 0x8f626c5c
                                        if (v6 != (int32_t)g4) {
                                            // 0x8f626c6c
                                            __stack_chk_fail();
                                            // branch -> 0x8f626c70
                                        }
                                        // 0x8f626c70
                                        return 3;
                                    }
                                    // 0x8f626a8c
                                    v46 = g11;
                                    v44 = g10;
                                    v50 = v46;
                                    v49 = v44;
                                    if ((v44 || v46) == 0) {
                                        // 0x8f626a94
                                        v63 = v55 - v56;
                                        g10 = v63;
                                        v69 = v55 < v56;
                                        g11 = v69;
                                        v50 = v69;
                                        v49 = v63;
                                        // branch -> 0x8f626aa4
                                    }
                                    // 0x8f626aa4
                                    v64 = v49 + v56;
                                    g8 = v64;
                                    v70 = v50 + (int32_t)(v64 < v49);
                                    g9 = v70;
                                    v47 = true;
                                    v43 = true;
                                    if (v70 == 0) {
                                        // if_8f626ab0_0_true
                                        v47 = v64 != v55;
                                        v43 = v64 >= v55;
                                        // branch -> after_if_8f626ab0_0
                                    }
                                    // after_if_8f626ab0_0
                                    if (v47 && v43) {
                                        // after_if_8f626ab8_0.thread
                                        // branch -> 0x8f626b78
                                        // 0x8f626b78
                                        fboot_info((int32_t)"INFO", (int32_t)"offset+size out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                        // branch -> 0x8f626b7c
                                    } else {
                                        // 0x8f626ac0
                                        v57 = v64 & -0x10000 | 511;
                                        v40 = (int32_t)"Offset not aligned on %d";
                                        if ((v57 & v56) == 0) {
                                            // 0x8f626ae0
                                            v34 = 0;
                                            if ((v57 & v49) == 0) {
                                                // 0x8f626b04
                                                if (strcmp((char *)str2, "logs") == 0) {
                                                    // 0x8f626b18
                                                    flush_logs(0, (int32_t)"logs", 0, v34, v9, v2, v8, v4);
                                                    // branch -> 0x8f626b1c
                                                }
                                                // 0x8f626b1c
                                                v51 = str2;
                                                v58 = g12;
                                                v67 = v35;
                                                v41 = (char *)v67;
                                                v59 = g10;
                                                v68 = g11;
                                                fboot_info((int32_t)"INFO", (int32_t)"%s: offset=0x%llx, size=0x%llx", v51, v34, v58, v67, v59, v68, 0, v7, 0);
                                                v60 = g12;
                                                v65 = v60 + v16;
                                                g12 = v65;
                                                v71 = (int32_t)(v65 < v60) + v35;
                                                fboot_ack((int32_t)"OKAY", (int32_t)&g3, v51, v34, v58, v67, v59, v68, 0, v7);
                                                speedo_start((int32_t)"dump_partition", (int32_t)&g3, v51, v34, v58, v67, v59, v68, 0, v7, 0);
                                                if (send_emmc_data(v65, v71, g10, g11) == 0) {
                                                    // 0x8f626b84
                                                    v52 = g11;
                                                    v53 = g10;
                                                    v33 = v53;
                                                    speedo_log((int32_t)"dump_partition", g7, v53, v52, v58, v67, v59, v68, 0, v7, 0, v18, v16, 0, v17, 0);
                                                    v31 = speedo_read((int32_t)"dump_partition", g7, v33, v52, v58, v67, v59, v68, 0, v7, 0);
                                                    v54 = g7;
                                                    v45 = (int32_t)(v31 == 0);
                                                    v22 = v54 - v45;
                                                    v21 = v54;
                                                    v20 = v58;
                                                    v42 = v41;
                                                    if (v54 >= v45) {
                                                        // 0x8f626bb0
                                                        v66 = 0x1000 * v54 | v31 / 0x100000;
                                                        v61 = v54 / 0x100000;
                                                        v1 = __aeabi_ldivmod((int64_t)v31, 0x19000);
                                                        __aeabi_ldivmod(v1.e0, 10);
                                                        v33 = v66;
                                                        fboot_info((int32_t)"INFO", (int32_t)"average dump speed: %lld.%lldMB/s", v66, v61, 10, 0, v59, v68, 0, v7, 0);
                                                        v22 = v61;
                                                        v21 = (int32_t)"average dump speed: %lld.%lldMB/s";
                                                        v20 = 10;
                                                        v42 = NULL;
                                                        // branch -> 0x8f626bec
                                                    }
                                                    // 0x8f626bec
                                                    speedo_delete((int32_t)"dump_partition", v21, v33, v22, v20, (int32_t)v42, v59, v68);
                                                    // branch -> 0x8f626850
                                                    // 0x8f626850
                                                    v12 = 1;
                                                    v13 = 1;
                                                    // branch -> 0x8f626c5c
                                                } else {
                                                    // 0x8f626b70
                                                    // branch -> 0x8f626b78
                                                    // 0x8f626b78
                                                    fboot_info((int32_t)"INFO", (int32_t)"failed to send data", g8, g9, v58, (int32_t)v41, v59, (int32_t)(char *)v68, 0, v7, 0);
                                                    // branch -> 0x8f626b7c
                                                    // 0x8f626b7c
                                                    v12 = 3;
                                                    v13 = 3;
                                                    // branch -> 0x8f626c5c
                                                }
                                                // 0x8f626c5c
                                                if (v6 != (int32_t)g4) {
                                                    // 0x8f626c6c
                                                    __stack_chk_fail();
                                                    result3 = v12;
                                                    // branch -> 0x8f626c70
                                                } else {
                                                    result3 = v13;
                                                }
                                                // 0x8f626c70
                                                return result3;
                                            }
                                            v40 = (int32_t)"Size not aligned on %d";
                                        }
                                        // 0x8f626af8
                                        // branch -> 0x8f626afc
                                        // 0x8f626afc
                                        fboot_info((int32_t)"INFO", v40, 512, 0, v9, v2, v8, v4, 0, v7, 0);
                                        // branch -> 0x8f626b7c
                                    }
                                    // 0x8f626b7c
                                    // branch -> 0x8f626c5c
                                    // 0x8f626c5c
                                    if (v6 != (int32_t)g4) {
                                        // 0x8f626c6c
                                        __stack_chk_fail();
                                        // branch -> 0x8f626c70
                                    }
                                    // 0x8f626c70
                                    return 3;
                                }
                                // after_if_8f626a84_0.thread19
                                // branch -> 0x8f626b78
                                // 0x8f626b78
                                fboot_info((int32_t)"INFO", (int32_t)"offset out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                // branch -> 0x8f626b7c
                            }
                            // 0x8f626b7c
                            // branch -> 0x8f626c5c
                            // 0x8f626c5c
                            if (v6 != (int32_t)g4) {
                                // 0x8f626c6c
                                __stack_chk_fail();
                                // branch -> 0x8f626c70
                            }
                            // 0x8f626c70
                            return 3;
                        }
                        // after_if_8f626a44_0
                        // branch -> 0x8f626b78
                        // 0x8f626b78
                        fboot_info((int32_t)"INFO", (int32_t)"Command Restricted", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                        // branch -> 0x8f626b7c
                        // 0x8f626b7c
                        // branch -> 0x8f626c5c
                    } else {
                        // 0x8f62694c
                        if (v29 == 0) {
                            // 0x8f62694c
                            // branch -> 0x8f6269b8
                            // 0x8f6269b8
                            v48 = str2;
                            g8 = v48;
                            print_log(1, (int32_t)"dumping gpt%s...\n", v48, g9, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                            strcmp_rc4 = strcmp((char *)str2, "main_gpt");
                            v39 = 0;
                            if (strcmp_rc4 != 0) {
                                // 0x8f6269dc
                                if (strcmp((char *)str2, "backup_gpt") != 0) {
                                    // 0x8f6269f4
                                    // branch -> 0x8f626b78
                                    // 0x8f626b78
                                    fboot_info((int32_t)"INFO", (int32_t)"Invalid dump gpt command", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                    // branch -> 0x8f626b7c
                                    // 0x8f626b7c
                                    // branch -> 0x8f626c5c
                                    // 0x8f626c5c
                                    if (v6 != (int32_t)g4) {
                                        // 0x8f626c6c
                                        __stack_chk_fail();
                                        // branch -> 0x8f626c70
                                    }
                                    // 0x8f626c70
                                    return 3;
                                }
                                v39 = 0x8000;
                            }
                            // 0x8f626a04
                            g10 = v39;
                            g11 = 0;
                            fboot_ack((int32_t)"OKAY", (int32_t)&g3, g8, g9, v9, v2, v8, v4, 0, v7);
                            v28 = send_emmc_data(g10, 0, 0x8000, 0);
                            // branch -> 0x8f626c5c
                            // 0x8f626c5c
                            if (v6 != (int32_t)g4) {
                                // 0x8f626c6c
                                __stack_chk_fail();
                                // branch -> 0x8f626c70
                            }
                            // 0x8f626c70
                            return v28 < 0 ? 3 : v28 > -1 ? 1 : v28;
                        }
                        // 0x8f626958
                        v37 = 0;
                        v26 = __utag_sizeof(NULL, (int32_t)"enable_dump_gpt", g8, g9, v9, v2, v8, v4, 0);
                        if (v26 == 1) {
                            // 0x8f626980
                            v23 = &v37;
                            g8 = v23;
                            g9 = 1;
                            v27 = __utag_read((char *)0, (int32_t)"enable_dump_gpt", v23, 1, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                            if (v27 != 0) {
                                // 0x8f62699c
                                v36 = 0x1000000 * v37;
                                v62 = v36 / 0x1000000;
                                g9 = v62;
                                if ((v36 || 0xffffff) >= 0x1ffffff) {
                                    // 0x8f6269a8
                                    if (v26 % 2 == 0) {
                                        // after_if_8f6269b0_0
                                        // branch -> 0x8f626b78
                                        // 0x8f626b78
                                        fboot_info((int32_t)"INFO", (int32_t)"Dumping GPT is disabled!", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                        // branch -> 0x8f626b7c
                                        // 0x8f626b7c
                                        v12 = 3;
                                        v13 = 3;
                                        // branch -> 0x8f626c5c
                                    } else {
                                        // 0x8f6269b8
                                        v48 = str2;
                                        g8 = v48;
                                        print_log(1, (int32_t)"dumping gpt%s...\n", v48, v62, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                                        strcmp_rc4 = strcmp((char *)str2, "main_gpt");
                                        v39 = 0;
                                        if (strcmp_rc4 != 0) {
                                            // 0x8f6269dc
                                            if (strcmp((char *)str2, "backup_gpt") != 0) {
                                                // 0x8f6269f4
                                                // branch -> 0x8f626b78
                                                // 0x8f626b78
                                                fboot_info((int32_t)"INFO", (int32_t)"Invalid dump gpt command", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                                // branch -> 0x8f626b7c
                                                // 0x8f626b7c
                                                // branch -> 0x8f626c5c
                                                // 0x8f626c5c
                                                if (v6 != (int32_t)g4) {
                                                    // 0x8f626c6c
                                                    __stack_chk_fail();
                                                    // branch -> 0x8f626c70
                                                }
                                                // 0x8f626c70
                                                return 3;
                                            }
                                            v39 = 0x8000;
                                        }
                                        // 0x8f626a04
                                        g10 = v39;
                                        g11 = 0;
                                        fboot_ack((int32_t)"OKAY", (int32_t)&g3, g8, g9, v9, v2, v8, v4, 0, v7);
                                        v28 = send_emmc_data(g10, 0, 0x8000, 0);
                                        v19 = v28 < 0 ? 3 : v28 > -1 ? 1 : v28;
                                        v12 = v19;
                                        v13 = v19;
                                        // branch -> 0x8f626c5c
                                    }
                                    // 0x8f626c5c
                                    if (v6 != (int32_t)g4) {
                                        // 0x8f626c6c
                                        __stack_chk_fail();
                                        result3 = v12;
                                        // branch -> 0x8f626c70
                                    } else {
                                        result3 = v13;
                                    }
                                    // 0x8f626c70
                                    return result3;
                                }
                            }
                        }
                        // 0x8f6269a8
                        // branch -> after_if_8f6269b0_0
                        // after_if_8f6269b0_0
                        // branch -> 0x8f626b78
                        // 0x8f626b78
                        fboot_info((int32_t)"INFO", (int32_t)"Dumping GPT is disabled!", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                        // branch -> 0x8f626b7c
                        // 0x8f626b7c
                        // branch -> 0x8f626c5c
                    }
                    // 0x8f626c5c
                    if (v6 != (int32_t)g4) {
                        // 0x8f626c6c
                        __stack_chk_fail();
                        // branch -> 0x8f626c70
                    }
                    // 0x8f626c70
                    return 3;
                }
                int32_t v72 = *(int32_t *)(a2 + 12); // 0x8f6268c8
                g9 = 0;
                g12 = atoull(v72, g7, g8, 0, v9, v2, v8, v4, 0, 0, 0, v15, 0, 0);
                int32_t v73 = g7; // 0x8f6268e0
                v35 = v73;
                if (g10 == 3) {
                    // 0x8f626910
                    g10 = 0;
                    g11 = 0;
                    v7 = 0;
                    // branch -> 0x8f626918
                } else {
                    int32_t v74 = *(int32_t *)(a2 + 16); // 0x8f6268e8
                    g10 = atoull(v74, v73, g8, 0, v9, v2, v8, v4, 0, 0, 0, v18, v16, 0);
                    g11 = g7;
                    v7 = 0;
                    // branch -> 0x8f626918
                }
                // 0x8f626918
                v32 = (int32_t)"main_gpt";
                strcmp_rc2 = strcmp((char *)str2, "main_gpt");
                v38 = 1;
                if (strcmp_rc2 != 0) {
                    // 0x8f626930
                    v32 = (int32_t)"backup_gpt";
                    strcmp_rc3 = strcmp((char *)str2, "backup_gpt");
                    v38 = strcmp_rc3 > 1 ? 0 : 1 - strcmp_rc3;
                    // branch -> 0x8f626944
                }
                // 0x8f626944
                v29 = is_validation_enabled((char *)v38, v32, g8, g9);
                if (v38 == 0) {
                    // 0x8f626a38
                    if (v29 == 0) {
                        // 0x8f626a4c
                        v24 = &v16;
                        g8 = v24;
                        v25 = &v17;
                        g9 = v25;
                        v30 = ptn_stat(str2, (int32_t)&v18, v24, v25, v9, v2, v8, v4, 0, v7, 0, v18, v16, 0, v17, 0, 0, v6);
                        if (v30 == 0) {
                            // if_8f626a64_0_true
                            // branch -> 0x8f626afc
                            // 0x8f626afc
                            fboot_info((int32_t)"INFO", (int32_t)"partition: %s not found", str2, g9, v9, v2, v8, v4, 0, v7, 0);
                            // branch -> 0x8f626b7c
                        } else {
                            // 0x8f626a74
                            v55 = v17;
                            if (v35 == 0) {
                                // after_if_8f626a7c_0
                                v56 = g12;
                                if (v55 <= v56) {
                                    // after_if_8f626a84_0
                                    // branch -> 0x8f626b78
                                    // 0x8f626b78
                                    fboot_info((int32_t)"INFO", (int32_t)"offset out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                    // branch -> 0x8f626b7c
                                    // 0x8f626b7c
                                    // branch -> 0x8f626c5c
                                    // 0x8f626c5c
                                    if (v6 != (int32_t)g4) {
                                        // 0x8f626c6c
                                        __stack_chk_fail();
                                        // branch -> 0x8f626c70
                                    }
                                    // 0x8f626c70
                                    return 3;
                                }
                                // 0x8f626a8c
                                v46 = g11;
                                v44 = g10;
                                v50 = v46;
                                v49 = v44;
                                if ((v44 || v46) == 0) {
                                    // 0x8f626a94
                                    v63 = v55 - v56;
                                    g10 = v63;
                                    v69 = v55 < v56;
                                    g11 = v69;
                                    v50 = v69;
                                    v49 = v63;
                                    // branch -> 0x8f626aa4
                                }
                                // 0x8f626aa4
                                v64 = v49 + v56;
                                g8 = v64;
                                v70 = v50 + (int32_t)(v64 < v49);
                                g9 = v70;
                                v47 = true;
                                v43 = true;
                                if (v70 == 0) {
                                    // if_8f626ab0_0_true
                                    v47 = v64 != v55;
                                    v43 = v64 >= v55;
                                    // branch -> after_if_8f626ab0_0
                                }
                                // after_if_8f626ab0_0
                                if (v47 && v43) {
                                    // after_if_8f626ab8_0.thread
                                    // branch -> 0x8f626b78
                                    // 0x8f626b78
                                    fboot_info((int32_t)"INFO", (int32_t)"offset+size out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                    // branch -> 0x8f626b7c
                                } else {
                                    // 0x8f626ac0
                                    v57 = v64 & -0x10000 | 511;
                                    v40 = (int32_t)"Offset not aligned on %d";
                                    if ((v57 & v56) == 0) {
                                        // 0x8f626ae0
                                        v34 = 0;
                                        if ((v57 & v49) == 0) {
                                            // 0x8f626b04
                                            if (strcmp((char *)str2, "logs") == 0) {
                                                // 0x8f626b18
                                                flush_logs(0, (int32_t)"logs", 0, v34, v9, v2, v8, v4);
                                                // branch -> 0x8f626b1c
                                            }
                                            // 0x8f626b1c
                                            v51 = str2;
                                            v58 = g12;
                                            v67 = v35;
                                            v41 = (char *)v67;
                                            v59 = g10;
                                            v68 = g11;
                                            fboot_info((int32_t)"INFO", (int32_t)"%s: offset=0x%llx, size=0x%llx", v51, v34, v58, v67, v59, v68, 0, v7, 0);
                                            v60 = g12;
                                            v65 = v60 + v16;
                                            g12 = v65;
                                            v71 = (int32_t)(v65 < v60) + v35;
                                            fboot_ack((int32_t)"OKAY", (int32_t)&g3, v51, v34, v58, v67, v59, v68, 0, v7);
                                            speedo_start((int32_t)"dump_partition", (int32_t)&g3, v51, v34, v58, v67, v59, v68, 0, v7, 0);
                                            if (send_emmc_data(v65, v71, g10, g11) == 0) {
                                                // 0x8f626b84
                                                v52 = g11;
                                                v53 = g10;
                                                v33 = v53;
                                                speedo_log((int32_t)"dump_partition", g7, v53, v52, v58, v67, v59, v68, 0, v7, 0, v18, v16, 0, v17, 0);
                                                v31 = speedo_read((int32_t)"dump_partition", g7, v33, v52, v58, v67, v59, v68, 0, v7, 0);
                                                v54 = g7;
                                                v45 = (int32_t)(v31 == 0);
                                                v22 = v54 - v45;
                                                v21 = v54;
                                                v20 = v58;
                                                v42 = v41;
                                                if (v54 >= v45) {
                                                    // 0x8f626bb0
                                                    v66 = 0x1000 * v54 | v31 / 0x100000;
                                                    v61 = v54 / 0x100000;
                                                    v1 = __aeabi_ldivmod((int64_t)v31, 0x19000);
                                                    __aeabi_ldivmod(v1.e0, 10);
                                                    v33 = v66;
                                                    fboot_info((int32_t)"INFO", (int32_t)"average dump speed: %lld.%lldMB/s", v66, v61, 10, 0, v59, v68, 0, v7, 0);
                                                    v22 = v61;
                                                    v21 = (int32_t)"average dump speed: %lld.%lldMB/s";
                                                    v20 = 10;
                                                    v42 = NULL;
                                                    // branch -> 0x8f626bec
                                                }
                                                // 0x8f626bec
                                                speedo_delete((int32_t)"dump_partition", v21, v33, v22, v20, (int32_t)v42, v59, v68);
                                                // branch -> 0x8f626850
                                                // 0x8f626850
                                                v12 = 1;
                                                v13 = 1;
                                                // branch -> 0x8f626c5c
                                            } else {
                                                // 0x8f626b70
                                                // branch -> 0x8f626b78
                                                // 0x8f626b78
                                                fboot_info((int32_t)"INFO", (int32_t)"failed to send data", g8, g9, v58, (int32_t)v41, v59, (int32_t)(char *)v68, 0, v7, 0);
                                                // branch -> 0x8f626b7c
                                                // 0x8f626b7c
                                                v12 = 3;
                                                v13 = 3;
                                                // branch -> 0x8f626c5c
                                            }
                                            // 0x8f626c5c
                                            if (v6 != (int32_t)g4) {
                                                // 0x8f626c6c
                                                __stack_chk_fail();
                                                result3 = v12;
                                                // branch -> 0x8f626c70
                                            } else {
                                                result3 = v13;
                                            }
                                            // 0x8f626c70
                                            return result3;
                                        }
                                        v40 = (int32_t)"Size not aligned on %d";
                                    }
                                    // 0x8f626af8
                                    // branch -> 0x8f626afc
                                    // 0x8f626afc
                                    fboot_info((int32_t)"INFO", v40, 512, 0, v9, v2, v8, v4, 0, v7, 0);
                                    // branch -> 0x8f626b7c
                                }
                                // 0x8f626b7c
                                // branch -> 0x8f626c5c
                                // 0x8f626c5c
                                if (v6 != (int32_t)g4) {
                                    // 0x8f626c6c
                                    __stack_chk_fail();
                                    // branch -> 0x8f626c70
                                }
                                // 0x8f626c70
                                return 3;
                            }
                            // after_if_8f626a84_0.thread19
                            // branch -> 0x8f626b78
                            // 0x8f626b78
                            fboot_info((int32_t)"INFO", (int32_t)"offset out of range", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                            // branch -> 0x8f626b7c
                        }
                        // 0x8f626b7c
                        // branch -> 0x8f626c5c
                        // 0x8f626c5c
                        if (v6 != (int32_t)g4) {
                            // 0x8f626c6c
                            __stack_chk_fail();
                            // branch -> 0x8f626c70
                        }
                        // 0x8f626c70
                        return 3;
                    }
                    // after_if_8f626a44_0
                    // branch -> 0x8f626b78
                    // 0x8f626b78
                    fboot_info((int32_t)"INFO", (int32_t)"Command Restricted", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                    // branch -> 0x8f626b7c
                    // 0x8f626b7c
                    // branch -> 0x8f626c5c
                } else {
                    // 0x8f62694c
                    if (v29 == 0) {
                        // 0x8f62694c
                        // branch -> 0x8f6269b8
                        // 0x8f6269b8
                        v48 = str2;
                        g8 = v48;
                        print_log(1, (int32_t)"dumping gpt%s...\n", v48, g9, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                        strcmp_rc4 = strcmp((char *)str2, "main_gpt");
                        v39 = 0;
                        if (strcmp_rc4 != 0) {
                            // 0x8f6269dc
                            if (strcmp((char *)str2, "backup_gpt") != 0) {
                                // 0x8f6269f4
                                // branch -> 0x8f626b78
                                // 0x8f626b78
                                fboot_info((int32_t)"INFO", (int32_t)"Invalid dump gpt command", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                // branch -> 0x8f626b7c
                                // 0x8f626b7c
                                // branch -> 0x8f626c5c
                                // 0x8f626c5c
                                if (v6 != (int32_t)g4) {
                                    // 0x8f626c6c
                                    __stack_chk_fail();
                                    // branch -> 0x8f626c70
                                }
                                // 0x8f626c70
                                return 3;
                            }
                            v39 = 0x8000;
                        }
                        // 0x8f626a04
                        g10 = v39;
                        g11 = 0;
                        fboot_ack((int32_t)"OKAY", (int32_t)&g3, g8, g9, v9, v2, v8, v4, 0, v7);
                        v28 = send_emmc_data(g10, 0, 0x8000, 0);
                        // branch -> 0x8f626c5c
                        // 0x8f626c5c
                        if (v6 != (int32_t)g4) {
                            // 0x8f626c6c
                            __stack_chk_fail();
                            // branch -> 0x8f626c70
                        }
                        // 0x8f626c70
                        return v28 < 0 ? 3 : v28 > -1 ? 1 : v28;
                    }
                    // 0x8f626958
                    v37 = 0;
                    v26 = __utag_sizeof(NULL, (int32_t)"enable_dump_gpt", g8, g9, v9, v2, v8, v4, 0);
                    if (v26 == 1) {
                        // 0x8f626980
                        v23 = &v37;
                        g8 = v23;
                        g9 = 1;
                        v27 = __utag_read((char *)0, (int32_t)"enable_dump_gpt", v23, 1, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                        if (v27 != 0) {
                            // 0x8f62699c
                            v36 = 0x1000000 * v37;
                            v62 = v36 / 0x1000000;
                            g9 = v62;
                            if ((v36 || 0xffffff) >= 0x1ffffff) {
                                // 0x8f6269a8
                                if (v26 % 2 == 0) {
                                    // after_if_8f6269b0_0
                                    // branch -> 0x8f626b78
                                    // 0x8f626b78
                                    fboot_info((int32_t)"INFO", (int32_t)"Dumping GPT is disabled!", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                    // branch -> 0x8f626b7c
                                    // 0x8f626b7c
                                    v12 = 3;
                                    v13 = 3;
                                    // branch -> 0x8f626c5c
                                } else {
                                    // 0x8f6269b8
                                    v48 = str2;
                                    g8 = v48;
                                    print_log(1, (int32_t)"dumping gpt%s...\n", v48, v62, v9, v2, v8, v4, 0, v7, 0, v18, v16);
                                    strcmp_rc4 = strcmp((char *)str2, "main_gpt");
                                    v39 = 0;
                                    if (strcmp_rc4 != 0) {
                                        // 0x8f6269dc
                                        if (strcmp((char *)str2, "backup_gpt") != 0) {
                                            // 0x8f6269f4
                                            // branch -> 0x8f626b78
                                            // 0x8f626b78
                                            fboot_info((int32_t)"INFO", (int32_t)"Invalid dump gpt command", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                                            // branch -> 0x8f626b7c
                                            // 0x8f626b7c
                                            // branch -> 0x8f626c5c
                                            // 0x8f626c5c
                                            if (v6 != (int32_t)g4) {
                                                // 0x8f626c6c
                                                __stack_chk_fail();
                                                // branch -> 0x8f626c70
                                            }
                                            // 0x8f626c70
                                            return 3;
                                        }
                                        v39 = 0x8000;
                                    }
                                    // 0x8f626a04
                                    g10 = v39;
                                    g11 = 0;
                                    fboot_ack((int32_t)"OKAY", (int32_t)&g3, g8, g9, v9, v2, v8, v4, 0, v7);
                                    v28 = send_emmc_data(g10, 0, 0x8000, 0);
                                    v19 = v28 < 0 ? 3 : v28 > -1 ? 1 : v28;
                                    v12 = v19;
                                    v13 = v19;
                                    // branch -> 0x8f626c5c
                                }
                                // 0x8f626c5c
                                if (v6 != (int32_t)g4) {
                                    // 0x8f626c6c
                                    __stack_chk_fail();
                                    result3 = v12;
                                    // branch -> 0x8f626c70
                                } else {
                                    result3 = v13;
                                }
                                // 0x8f626c70
                                return result3;
                            }
                        }
                    }
                    // 0x8f6269a8
                    // branch -> after_if_8f6269b0_0
                    // after_if_8f6269b0_0
                    // branch -> 0x8f626b78
                    // 0x8f626b78
                    fboot_info((int32_t)"INFO", (int32_t)"Dumping GPT is disabled!", g8, g9, v9, (int32_t)v3, v8, (int32_t)v5, 0, v7, 0);
                    // branch -> 0x8f626b7c
                    // 0x8f626b7c
                    // branch -> 0x8f626c5c
                }
                // 0x8f626c5c
                if (v6 != (int32_t)g4) {
                    // 0x8f626c6c
                    __stack_chk_fail();
                    // branch -> 0x8f626c70
                }
                // 0x8f626c70
                return 3;
            }
            // 0x8f626890
            oem_partition_usage(0, g7, g8, v6);
            // branch -> 0x8f626b7c
        }
        // 0x8f626b7c
        v12 = 3;
        v13 = 3;
        // branch -> 0x8f626c5c
    }
    // 0x8f626c5c
    if (v6 != (int32_t)g4) {
        // 0x8f626c6c
        __stack_chk_fail();
        result3 = v12;
        // branch -> 0x8f626c70
    } else {
        result3 = v13;
    }
    // 0x8f626c70
    return result3;
}

// --------------- Statically Linked Functions ----------------

// lldiv_t __aeabi_ldivmod(long long n, long long d);
// void __stack_chk_fail(void);
// void free(void * ptr);
// void * malloc(size_t size);
// void * memalign(size_t alignment, size_t size);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);
// int strcmp(const char * s1, const char * s2);
// int strncasecmp(const char * s1, const char * s2, size_t n);
// int strncmp(const char * s1, const char * s2, size_t n);
// size_t strnlen(const char * string, size_t maxlen);
// char * strrchr(char * s, int c);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 17
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:38:38
