//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t handle_fboot_oem_command_get_unlock_data(void);
int32_t handle_fboot_oem_command_prod_fuse(int32_t a1, int32_t a2);
int32_t oem_build_sig(int32_t a1, int32_t a2);
int32_t oem_display(int32_t a1, int32_t a2);
int32_t oem_dump_logs(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_led(int32_t a1, int32_t a2);
int32_t oem_logo(int32_t a1, int32_t a2);
int32_t oem_partition_usage(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_partitions(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_pmic(int32_t a1, int32_t a2, int32_t a3);
int32_t oem_read_sv(void);
int32_t oem_security_test(int32_t a1, int32_t a2);
int32_t oem_test_sp(int32_t a1, int32_t a2);
int32_t oem_usb_tune(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t ptn_stat(char * a1, int32_t * a2, int32_t * a3, int32_t * a4);
int32_t require_mot_fastboot(int32_t a1, int32_t a2, int32_t a3);
int32_t utag_name_prefix_found_cb(int32_t a1, char * str2, char * str);
int32_t utag_shortnameof(void);

// --------------------- Global Variables ---------------------

int32_t g22 = 0; // LR
int32_t g23 = 0; // R0
int32_t g24 = 0; // R1
int32_t g25 = 0; // R2
int32_t g26 = 0; // R3
int32_t g27 = 0; // R4
int32_t g28 = 0; // R5
int32_t g29 = 0; // R6
int32_t g30 = 0; // R7
int32_t g31 = 0; // R8
int32_t g1 = -0x16d2bfed; // 0x8f61c43c
int32_t g2 = -0x16d2bfed; // 0x8f61c478
int32_t g3 = -0x16d2bf10; // 0x8f61c4ac
int32_t g4 = -0x16d2bff0; // 0x8f61c534
int32_t g5 = -0x1a60cf20; // 0x8f61c5a8
int32_t g6 = -0x1a60cfc8; // 0x8f624774
int32_t g7 = -0x15ffffc8; // 0x8f625868
int32_t g8 = -0x1a60cf7c; // 0x8f63867c
int32_t g9 = -0x16d2bc09; // 0x8f638ab0
int32_t g10 = 0x746e6300; // 0x8f6a4e20
int32_t g11 = -0x709c73f8; // 0x8f6ac374
int32_t g12 = 0; // 0x8f6c05e0
char * g13; // 0x8f6c0600
int32_t g14 = 0; // 0x8f6c0624
int32_t (*g15)() = NULL; // 0x8f7112f4
char * g16; // 0x8f711580
char * g17; // 0x8f711588
char * g18; // 0x8f711589
char g19 = 0; // 0x8f71158a
char g20 = 0; // 0x8f71158b
int32_t g21 = 0; // 0x8f7125ec

// ------------------------ Functions -------------------------

// Address range: 0x8f62544c - 0x8f6257c7
int32_t oem_logo(int32_t a1, int32_t a2) {
    // 0x8f62544c
    int32_t v1;
    char * v2 = (char *)v1;
    int32_t v3 = 0; // 0x8f62544c
    int32_t v4 = a1 - 1; // R5
    int32_t (*v5)() = g15;
    int32_t v6 = (int32_t)v5;
    if (a1 == 1) {
        // 0x8f62546c
        oem_logo_usage(1, a2);
        // branch -> 0x8f62574c
        // 0x8f62574c
        if (v5 != g15) {
            // 0x8f625760
            __stack_chk_fail();
            // branch -> 0x8f625764
        }
        // 0x8f625764
        return 1;
    }
    int32_t str = *(int32_t *)(a2 + 4); // 0x8f625474
    int32_t v7 = (int32_t)"list"; // R1
    int32_t str2; // R4
    if (strcmp((char *)str, "list") == 0 && v4 == 1) {
        int32_t v8 = partition_get_index((int32_t)"logo", v7, g25, v6, v1, 0); // 0x8f625498
        if (v8 != -1) {
            // 0x8f6254b0
            if (get_partition_by_index(v8, v7, g25, v6) == 0) {
                // if_8f6254b8_0_true
                // branch -> 0x8f625574
                // 0x8f625574
                fboot_info((int32_t)"INFO", (int32_t)"No valid logo entry!", g25, v6, (int32_t)v2, 0, 0, v6, 0, g27, g28);
                // branch -> 0x8f62574c
                // 0x8f62574c
                if (v5 != g15) {
                    // 0x8f625760
                    __stack_chk_fail();
                    // branch -> 0x8f625764
                }
                // 0x8f625764
                return 1;
            }
            // 0x8f6254c4
            str2 = (int32_t)&g16;
            int32_t v9 = partition_get_offset(v8, v7, g25); // 0x8f6254cc
            g25 = 0x1000;
            char * v10 = (char *)str2;
            int32_t v11;
            if (generic_mmc_read_logical(v9, v7, 0x1000, 0, str2, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3, 0, 0, g22, v11, 0, 0, 0, 0) != 0) {
                // if_8f6254e4_0_true
                // branch -> 0x8f625574
                // 0x8f625574
                fboot_info((int32_t)"INFO", (int32_t)"Failed in reading logo header!", g25, 0, (int32_t)v10, 0, 0, v6, 0, g27, g28);
                // branch -> 0x8f62574c
                // 0x8f62574c
                if (v5 != g15) {
                    // 0x8f625760
                    __stack_chk_fail();
                    // branch -> 0x8f625764
                }
                // 0x8f625764
                return 1;
            }
            // 0x8f6254f0
            memcpy((char *)&g17, (char *)&g18, g25 & -0x10000 | 4087);
            char v12 = *(char *)&g18; // 0x8f625500
            char v13 = *(char *)&g17; // 0x8f625504
            uint32_t v14 = ((int32_t)v13 | 256 * (int32_t)v12 | 0x10000 * (int32_t)g19 | 0x1000000 * (int32_t)g20) - 1; // 0x8f625520
            *(char *)&g17 = (char)v14;
            *(char *)&g18 = (char)(v14 / 256);
            int32_t v15 = v14 / 0x1000000; // 0x8f625534
            g19 = v14 / 0x10000;
            g20 = v15;
            int32_t len = strlen("MotoLogo"); // 0x8f625540
            g25 = len;
            if (strncmp((char *)str2, "MotoLogo", len) == 0) {
                int32_t v16 = 12; // R6
                v4 = 0;
                int32_t v17 = 12; // 0x8f62565c
                // branch -> 0x8f62563c
                while (true) {
                    char v18 = *(char *)&g18; // 0x8f62563c
                    int32_t str3 = v17 + str2; // R8
                    char v19 = *(char *)&g17; // 0x8f625644
                    if (v17 < ((int32_t)v19 || 256 * (int32_t)v18 || 0x10000 * (int32_t)g19 || 0x1000000 * (int32_t)g20)) {
                        int32_t len2 = strlen("logo_"); // 0x8f625580
                        if (strncmp((char *)str3, "logo_", len2) == 0) {
                            int32_t v20 = v4 + 1; // 0x8f62559c
                            int32_t v21 = 32 * v20 + str2; // 0x8f6255a4
                            char v22 = *(char *)(v21 + 5); // 0x8f6255a8
                            char v23 = *(char *)(v21 + 4); // 0x8f6255ac
                            char v24 = *(char *)(v21 + 9); // 0x8f6255b0
                            char v25 = *(char *)(v21 + 6); // 0x8f6255b8
                            unsigned char v26 = *(char *)(v21 + 7); // 0x8f6255bc
                            char v27 = *(char *)(v21 + 8); // 0x8f6255c4
                            char v28 = *(char *)(v21 + 10); // 0x8f6255d0
                            char v29 = *(char *)(v21 + 11); // 0x8f6255d8
                            int32_t v30 = 0x1000000 * (int32_t)v29 | 0x10000 * (int32_t)v28 | (int32_t)v27 | 256 * (int32_t)v24; // 0x8f6255dc
                            fboot_info((int32_t)"INFO", (int32_t)"%s: offset 0x%x, size 0x%x", str3, 0x10000 * (int32_t)v25 | (int32_t)v23 | 256 * (int32_t)v22 | 0x1000000 * (int32_t)v26, v30, 0, 0, v6, 0, g27, g28);
                            char v31 = *(char *)(v21 + 5); // 0x8f6255f0
                            char v32 = *(char *)(v21 + 4); // 0x8f6255f4
                            char v33 = *(char *)(v21 + 7); // 0x8f6255f8
                            int32_t v34 = (int32_t)*(char *)(v21 + 6); // 0x8f625600
                            uint32_t v35 = *(int32_t *)(g21 + 8); // 0x8f625610
                            if ((0x1000000 * (int32_t)v33 || (int32_t)v32 || 256 * (int32_t)v31 || 0x10000 * v34) % v35 != 0) {
                                // 0x8f625620
                                fboot_info((int32_t)"INFO", (int32_t)"  The start address not sector aligned!\n", v34, g21, v30, 0, 0, v6, 0, g27, g28);
                                // branch -> 0x8f62562c
                            }
                            v4 = v20;
                            int32_t v36 = v16 + 32; // 0x8f625634
                            v16 = v36;
                            if (v20 != 5) {
                                // 0x8f62562c
                                v17 = v36;
                                // branch -> 0x8f62563c
                                continue;
                            }
                        }
                    }
                }
            } else {
                // 0x8f62556c
                // branch -> 0x8f625574
                // 0x8f625574
                fboot_info((int32_t)"INFO", (int32_t)"OLD logo or empty logo partition", g25, v15, (int32_t)v10, 0, 0, v6, 0, g27, g28);
                // branch -> 0x8f62574c
            }
            // 0x8f62574c
            if (v5 != g15) {
                // 0x8f625760
                __stack_chk_fail();
                // branch -> 0x8f625764
            }
            // 0x8f625764
            return 1;
        }
        // if_8f6254a4_0_true
        // branch -> 0x8f625574
        // 0x8f625574
        fboot_info((int32_t)"INFO", (int32_t)"No valid logo partition!", g25, v6, (int32_t)v2, 0, 0, v6, 0, g27, g28);
        // branch -> 0x8f62574c
    } else {
        int32_t strcmp_rc = strcmp((char *)str, "show"); // 0x8f625670
        int32_t v37 = strcmp_rc; // 0x8f62546c
        if (strcmp_rc == 0) {
            // 0x8f62567c
            if (v4 == 2) {
                int32_t str4 = *(int32_t *)(a2 + 8); // 0x8f625684
                str2 = str4;
                v7 = (int32_t)"logo_boot";
                int32_t strcmp_rc2 = strcmp((char *)str4, "logo_boot"); // 0x8f625690
                int32_t v38; // 0x8f625728
                int32_t v39; // 0x8f6256fc
                int32_t v40; // 0x8f625734
                if (strcmp_rc2 == 0) {
                    // 0x8f6256fc
                    v39 = set_logo(0, v7, g25, v6);
                    if (is_fastboot_screen(strcmp_rc2, v7, v39, v6) != 0) {
                        // 0x8f625730
                        v40 = set_logo_screen_mode(2, v7, v39, v6);
                        show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                        // branch -> 0x8f62574c
                        // 0x8f62574c
                        if (v5 != g15) {
                            // 0x8f625760
                            __stack_chk_fail();
                            // branch -> 0x8f625764
                        }
                        // 0x8f625764
                        return 1;
                    }
                    v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                    while (is_fastboot_screen(v38, v7, v39, v6) == 0) {
                        // 0x8f625724
                        v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                        // continue -> 0x8f625724
                    }
                    // 0x8f625730
                    v40 = set_logo_screen_mode(2, v7, v39, v6);
                    show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                    // branch -> 0x8f62574c
                    // 0x8f62574c
                    if (v5 != g15) {
                        // 0x8f625760
                        __stack_chk_fail();
                        // branch -> 0x8f625764
                    }
                    // 0x8f625764
                    return 1;
                }
                // 0x8f62569c
                v7 = (int32_t)"logo_battery";
                if (strcmp((char *)str2, "logo_battery") == 0) {
                    // if_8f6256ac_0_true
                    // branch -> 0x8f6256fc
                    // 0x8f6256fc
                    v39 = set_logo(v4, v7, g25, v6);
                    if (is_fastboot_screen(v4, v7, v39, v6) != 0) {
                        // 0x8f625730
                        v40 = set_logo_screen_mode(2, v7, v39, v6);
                        show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                        // branch -> 0x8f62574c
                        // 0x8f62574c
                        if (v5 != g15) {
                            // 0x8f625760
                            __stack_chk_fail();
                            // branch -> 0x8f625764
                        }
                        // 0x8f625764
                        return 1;
                    }
                    v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                    while (is_fastboot_screen(v38, v7, v39, v6) == 0) {
                        // 0x8f625724
                        v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                        // continue -> 0x8f625724
                    }
                    // 0x8f625730
                    v40 = set_logo_screen_mode(2, v7, v39, v6);
                    show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                    // branch -> 0x8f62574c
                    // 0x8f62574c
                    if (v5 != g15) {
                        // 0x8f625760
                        __stack_chk_fail();
                        // branch -> 0x8f625764
                    }
                    // 0x8f625764
                    return 1;
                }
                // 0x8f6256b4
                v7 = (int32_t)"logo_unlocked";
                if (strcmp((char *)str2, "logo_unlocked") == 0) {
                    // if_8f6256c4_0_true
                    // branch -> 0x8f6256fc
                    // 0x8f6256fc
                    v39 = set_logo(1, v7, g25, v6);
                    if (is_fastboot_screen(1, v7, v39, v6) != 0) {
                        // 0x8f625730
                        v40 = set_logo_screen_mode(2, v7, v39, v6);
                        show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                        // branch -> 0x8f62574c
                        // 0x8f62574c
                        if (v5 != g15) {
                            // 0x8f625760
                            __stack_chk_fail();
                            // branch -> 0x8f625764
                        }
                        // 0x8f625764
                        return 1;
                    }
                    v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                    while (is_fastboot_screen(v38, v7, v39, v6) == 0) {
                        // 0x8f625724
                        v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                        // continue -> 0x8f625724
                    }
                    // 0x8f625730
                    v40 = set_logo_screen_mode(2, v7, v39, v6);
                    show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                    // branch -> 0x8f62574c
                    // 0x8f62574c
                    if (v5 != g15) {
                        // 0x8f625760
                        __stack_chk_fail();
                        // branch -> 0x8f625764
                    }
                    // 0x8f625764
                    return 1;
                }
                // 0x8f6256cc
                v7 = (int32_t)"logo_lowpower";
                if (strcmp((char *)str2, "logo_lowpower") == 0) {
                    // if_8f6256dc_0_true
                    // branch -> 0x8f6256fc
                    // 0x8f6256fc
                    v39 = set_logo(3, v7, g25, v6);
                    if (is_fastboot_screen(3, v7, v39, v6) != 0) {
                        // 0x8f625730
                        v40 = set_logo_screen_mode(2, v7, v39, v6);
                        show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                        // branch -> 0x8f62574c
                        // 0x8f62574c
                        if (v5 != g15) {
                            // 0x8f625760
                            __stack_chk_fail();
                            // branch -> 0x8f625764
                        }
                        // 0x8f625764
                        return 1;
                    }
                    v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                    while (is_fastboot_screen(v38, v7, v39, v6) == 0) {
                        // 0x8f625724
                        v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                        // continue -> 0x8f625724
                    }
                    // 0x8f625730
                    v40 = set_logo_screen_mode(2, v7, v39, v6);
                    show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                    // branch -> 0x8f62574c
                    // 0x8f62574c
                    if (v5 != g15) {
                        // 0x8f625760
                        __stack_chk_fail();
                        // branch -> 0x8f625764
                    }
                    // 0x8f625764
                    return 1;
                }
                // 0x8f6256e4
                v7 = (int32_t)"logo_charge";
                if (strcmp((char *)str2, "logo_charge") == 0) {
                    // 0x8f6256f8
                    // branch -> 0x8f6256fc
                    // 0x8f6256fc
                    v39 = set_logo(4, v7, g25, v6);
                    if (is_fastboot_screen(4, v7, v39, v6) == 0) {
                        v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                        while (is_fastboot_screen(v38, v7, v39, v6) == 0) {
                            // 0x8f625724
                            v38 = thread_sleep(10, v7, v39, v6, v1, 0, 0, v6);
                            // continue -> 0x8f625724
                        }
                        // 0x8f625730
                        v40 = set_logo_screen_mode(2, v7, v39, v6);
                        show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                        // branch -> 0x8f62574c
                        // 0x8f62574c
                        if (v5 != g15) {
                            // 0x8f625760
                            __stack_chk_fail();
                            // branch -> 0x8f625764
                        }
                        // 0x8f625764
                        return 1;
                    }
                    // 0x8f625730
                    v40 = set_logo_screen_mode(2, v7, v39, v6);
                    show((int32_t)"logo_screen", 1, v40, (int32_t)&g9, v1, 0, 0, v6, 0, g27, g28, g29, g30, g31, v3);
                    // branch -> 0x8f62574c
                } else {
                    // 0x8f625704
                    fboot_info((int32_t)"INFO", (int32_t)"Unknown logo name %s!", str2, v6, v1, 0, 0, v6, 0, g27, g28);
                    // branch -> 0x8f62574c
                }
                // 0x8f62574c
                if (v5 != g15) {
                    // 0x8f625760
                    __stack_chk_fail();
                    // branch -> 0x8f625764
                }
                // 0x8f625764
                return 1;
            }
            v37 = 0;
        }
        // 0x8f62546c
        oem_logo_usage(v37, (int32_t)"show");
        // branch -> 0x8f62574c
    }
    // 0x8f62574c
    if (v5 != g15) {
        // 0x8f625760
        __stack_chk_fail();
        // branch -> 0x8f625764
    }
    // 0x8f625764
    return 1;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// int atoi(const char * nptr);
// long int atol(const char * nptr);
// void free(void * ptr);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// int strcmp(const char * s1, const char * s2);
// size_t strlen(const char * s);
// int strncmp(const char * s1, const char * s2, size_t n);
// char * strrchr(char * s, int c);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 18
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:38:36
