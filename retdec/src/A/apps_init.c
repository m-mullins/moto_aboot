//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

int32_t __utag_gets_constprop_4_4(char * a1, int32_t a2, int32_t a3);
char * __utag_puts_constprop_5(char * str2, char * a2);
int32_t app_thread_entry(int32_t a1, int32_t a2);
int32_t apps_init(int32_t a1, int32_t a2, int32_t a3);
int32_t gpt_get_back_zone_address(int32_t a1, int32_t a2, int32_t a3);
int32_t insert_timer_in_queue(int32_t a1, int32_t a2, int32_t a3);
char * mbm_entry(void);
int32_t pmic_decode_reg(int32_t a1, int32_t a2);
int32_t pmic_get_name(void);
int32_t pmic_get_version(int32_t a1);
int32_t pmic_read_reg(int32_t a1, int32_t a2);
int32_t pmic_write_reg(int32_t a1, uint32_t a2);
int32_t timer_initialize(int32_t * a1, int32_t a2, int32_t a3);
int32_t timer_set(int32_t a1, int32_t a2, int32_t a3);
int32_t timer_tick(int32_t a1, int32_t a2, int32_t a3);
int32_t type_atoi_3(char * str, int32_t a2, int32_t a3);
int32_t type_itoa(int32_t a1, int32_t a2, int32_t a3);
int32_t wait_queue_timeout_handler(int32_t a1, int32_t a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g33 = 0; // LR
int32_t g34 = 0; // R0
int32_t g35 = 0; // R1
int32_t g36 = 0; // R2
int32_t g37 = 0; // R3
int32_t g38 = 0; // R4
int32_t g39 = 0; // R5
int32_t g40 = 0; // R6
int32_t g41 = 0; // R7
int32_t g42 = 0; // R8
int32_t g43 = 0; // R9
int32_t g1 = -0x16d2bfed; // 0x8f61c6b4
int32_t g2 = -0x16d2be10; // 0x8f61cfe4
int32_t g3 = -0x16d2bf90; // 0x8f61db1c
int32_t g4 = -0x16d2bf81; // 0x8f61dca0
int32_t g5 = -0x1a60ced0; // 0x8f638854
int32_t g6 = -0x16d2bfe1; // 0x8f6389cc
char * g7[28] = {
    "unknown",
    "pm8941",
    "pm8841",
    "pm8019",
    "pm8026",
    "pm8110",
    "pma8084",
    "pmi8962",
    "pmd9635",
    "pm8994",
    "pmi8994",
    "pm8916",
    "reserved",
    "warm reset",
    "immediate XVDD shutdown",
    "reserved",
    "shutdown",
    "DVDD shutdown",
    "XVDD shutdown",
    "hardware reset",
    "DVDD hardware reset",
    "XVDD hardware reset",
    "warm reset and DVDD shutdown",
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681dcc
char * g8[12] = {
    "shutdown",
    "DVDD shutdown",
    "XVDD shutdown",
    "hardware reset",
    "DVDD hardware reset",
    "XVDD hardware reset",
    "warm reset and DVDD shutdown",
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e0c
char * g9[8] = {
    "DVDD hardware reset",
    "XVDD hardware reset",
    "warm reset and DVDD shutdown",
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e1c
char * g10[7] = {
    "XVDD hardware reset",
    "warm reset and DVDD shutdown",
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e20
char * g11[6] = {
    "warm reset and DVDD shutdown",
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e24
char * g12[5] = {
    "warm reset and XVDD shutdown",
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e28
char * g13[4] = {
    "warm reset and shutdown",
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e2c
char * g14[3] = {
    "warm reset then hardware reset",
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e30
char * g15[2] = {
    "warm reset then DVDD hardware reset",
    "warm reset then XVDD hardware reset"
}; // 0x8f681e34
char (*g16)[36] = "warm reset then XVDD hardware reset"; // 0x8f681e38
int32_t g17 = 0x2020003a; // 0x8f686ac4
int32_t g20 = -0x709d39dc; // 0x8f6a93e4
int32_t g21 = 1; // 0x8f6ac0f0
char * g24[2] = {
    "ttyHSL0,115200,n8",
    "ttyHSL0,115200,n8"
}; // 0x8f6ac1a8
int32_t g25 = 0; // 0x8f6c01d0
int32_t g26 = 0; // 0x8f6c01d4
char * g27; // 0x8f6c01d8
char * g28; // 0x8f6c0258
char * g29; // 0x8f6c0298
int32_t g30 = 0; // 0x8f7112f4
char * g31; // 0x8f7114b0
int32_t g32 = 0; // 0x8f7114b4
char * g18[2] = {
    "mbm",
    (char *)&g2
}; // 0x8f6a93c4
char * g19[3] = {
    "screen_manager",
    (char *)&g6,
    (char *)&g5
}; // 0x8f6a93d4
char * g22[4] = {
    "null",
    "fastboot",
    (char *)&g3,
    (char *)&g4
}; // 0x8f6ac108
char * g23[3] = {
    "fastboot",
    (char *)&g3,
    (char *)&g4
}; // 0x8f6ac10c

// ------------------------ Functions -------------------------

// Address range: 0x8f61c6f4 - 0x8f61c7d3
int32_t apps_init(int32_t a1, int32_t a2, int32_t a3) {
    // 0x8f61c6f4
    g35 = a2;
    int32_t v1 = g38; // 0x8f61c6f4
    int32_t v2 = g39; // 0x8f61c6f4
    int32_t v3 = g40; // 0x8f61c6f4
    int32_t v4 = g41; // 0x8f61c6f4
    int32_t v5 = g42; // 0x8f61c6f4
    int32_t v6 = g33; // 0x8f61c6f4
    g38 = (int32_t)&g18;
    g39 = &g20;
    int32_t result = g30;
    g36 = result;
    g40 = &g30;
    g41 = &g20;
    int32_t v7; // 0x8f61c7941
    int32_t v8; // 0x8f61c79427
    int32_t v9; // R4
    int32_t v10; // R5
    int32_t v11; // R8
    int32_t v12; // 0x8f61c76c
    if ((int32_t)&g18 == (int32_t)&g20) {
        // 0x8f61c738
        v9 = (int32_t)&g19;
        v11 = 0x2000;
        v10 = (int32_t)&g19 - 16;
        if ((int32_t)&g20 != (int32_t)&g19 - 16) {
            v12 = (int32_t)&g19;
            v8 = a1;
            while (true) {
                // 0x8f61c74c
                if (*(int32_t *)(v12 - 8) == 0) {
                    v7 = v8;
                    goto lab_0x8f61c798;
                }
                goto lab_0x8f61c758;
            }
        }
        // 0x8f61c7a0
        if (result != g30) {
            // 0x8f61c7b0
            __stack_chk_fail();
            // branch -> 0x8f61c7b4
        }
        // 0x8f61c7b4
        return result;
    }
    int32_t v13 = &g20; // 0x8f61c71013
    int32_t v14 = (int32_t)&g18; // 0x8f61c728
    while (true) {
        int32_t v15 = *(int32_t *)(v14 + 4); // 0x8f61c71c
        g37 = v15;
        int32_t v16 = v13; // 0x8f61c710
        int32_t v17 = v14; // 0x8f61c730
        if (v15 != 0) {
            // 0x8f61c728
            g34 = v14;
            g33 = -0x709e38d0;
            ((int32_t (*)(int32_t))v15)(v14);
            v16 = g39;
            v17 = g38;
            // branch -> 0x8f61c730
        }
        int32_t v18 = v17 + 16; // 0x8f61c730
        g38 = v18;
        g41 = &g20;
        if (v18 == v16) {
            // break -> 0x8f61c738
            break;
        }
        v13 = v16;
        v14 = v18;
        // continue -> 0x8f61c71c
    }
    // 0x8f61c738
    v9 = (int32_t)&g19;
    v11 = 0x2000;
    v10 = (int32_t)&g19 - 16;
    if ((int32_t)&g20 == (int32_t)&g19 - 16) {
        // 0x8f61c7a0
        if (result != g30) {
            // 0x8f61c7b0
            __stack_chk_fail();
            // branch -> 0x8f61c7b4
        }
        // 0x8f61c7b4
        return result;
    }
    v12 = (int32_t)&g19;
    v8 = a1;
    while (true) {
        // 0x8f61c74c
        v7 = v8;
        if (*(int32_t *)(v12 - 8) != 0) {
          lab_0x8f61c758:;
            uint32_t v19 = *(int32_t *)(v12 - 4); // 0x8f61c758
            if (v19 % 2 == 0) {
                int32_t v20 = *(int32_t *)(v12 - 16); // 0x8f61c76c
                print_log(1, (int32_t)"starting app %s\n", v20, v19, v8, a2, a3, result, v1, v2, v3, v4, v5);
                int32_t v21 = *(int32_t *)(v9 - 16); // 0x8f61c778
                int32_t v22 = v10; // 0x8f61c77c
                int32_t v23 = thread_create(v21, (int32_t)&g1, v22, 16, v11, a2, a3, result, v1, v2, v3, v4, v5, v6); // 0x8f61c788
                if (v23 != 0) {
                    // 0x8f61c794
                    thread_resume(v23, (int32_t)&g1, v22, 16, v11, a2, a3);
                    v7 = v11;
                    // branch -> 0x8f61c798
                } else {
                    v7 = v11;
                }
            } else {
                v7 = v8;
            }
        }
      lab_0x8f61c798:;
        int32_t v24 = v9; // 0x8f61c798
        int32_t v25 = v24 + 16; // 0x8f61c798
        v9 = v25;
        v10 = v24;
        if (v24 == g41) {
            // break -> 0x8f61c7a0
            break;
        }
        v12 = v25;
        v8 = v7;
        // continue -> 0x8f61c74c
    }
    // 0x8f61c7a0
    if (result != g30) {
        // 0x8f61c7b0
        __stack_chk_fail();
        // branch -> 0x8f61c7b4
    }
    // 0x8f61c7b4
    return result;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// void * memset(void * s, int c, size_t n);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);
// int strcmp(const char * s1, const char * s2);
// char * strncpy(char * restrict dest, const char * restrict src, size_t n);
// size_t strnlen(const char * string, size_t maxlen);
// char * strrchr(char * s, int c);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 18
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:36:16
