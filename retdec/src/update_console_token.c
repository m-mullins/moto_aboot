//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

// ------------------------ Structures ------------------------

struct tm {
    int32_t e0;
    int32_t e1;
    int32_t e2;
    int32_t e3;
    int32_t e4;
    int32_t e5;
    int32_t e6;
    int32_t e7;
    int32_t e8;
    int32_t e9;
    char * e10;
};

// ------------------- Function Prototypes --------------------

int32_t __utag_gets_constprop_3_6(char * a1, int32_t a2);
int32_t __utag_gets_constprop_5(char * a1, int32_t a2, int32_t a3);
int32_t boot_handler(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
int32_t check_wififlash_mode(char * a1, int32_t a2);
int32_t fastboot_reason(int32_t a1);
int32_t fboot_ack(char * str, char * format, int32_t a3);
int32_t get_sku(char * a1, int32_t a2);
int32_t init_boot_event(int32_t a1, int32_t a2);
int32_t load_and_validate_kernel_image(int32_t a1);
char * mbm_entry(void);
char * mbm_init(void);
int32_t select_device_tree(int32_t a1, int32_t a2);
int32_t set_boot_item(int32_t result, int32_t a2, int32_t a3);
int32_t sparse_fill_value_in_blocks(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t type_atoi_5(char * str, int32_t a2, int32_t a3);
int32_t type_atoi_7(char * str, int32_t a2, int32_t a3);
int32_t update_console_token(char * a1, char * str, char * a3);

// --------------------- Global Variables ---------------------

int32_t g24 = 0; // LR
int32_t g25 = 0; // R0
int32_t g26 = 0; // R1
int32_t g27 = 0; // R10
int32_t g28 = 0; // R11
int32_t g29 = 0; // R2
int32_t g30 = 0; // R3
int32_t g31 = 0; // R4
int32_t g32 = 0; // R5
int32_t g33 = 0; // R6
int32_t g34 = 0; // R7
int32_t g35 = 0; // R8
int32_t g36 = 0; // R9
int32_t g1 = -0x16d2bf90; // 0x8f61db1c
int32_t g2 = -0x16d2bf81; // 0x8f61dca0
int32_t g3 = -0x16d2bfc9; // 0x8f6387c0
int32_t g4 = -0x16d2bc09; // 0x8f638ab0
int32_t g5 = 0x2020003a; // 0x8f686ac4
char g6[2] = " "; // 0x8f6a4f1e
int32_t g7 = 1; // 0x8f6ac0f0
char * g10 = "\xd4\xc7\x61\x8f\x90\x15\x60\x8f"; // 0x8f6ac19c
char * g11[2] = {
    "ttyHSL0,115200,n8",
    "ttyHSL0,115200,n8"
}; // 0x8f6ac1a8
int32_t g12 = -0x709c73f8; // 0x8f6ac374
char * g13; // 0x8f6c0298
int32_t g14 = 0; // 0x8f6c02e0
int32_t g15 = 0; // 0x8f6c02ec
char * g16; // 0x8f6c0334
int32_t g17 = 0; // 0x8f7112f4
char * g18; // 0x8f7114b0
int32_t g19 = 0; // 0x8f7114b4
int32_t g20 = 0; // 0x8f7114b8
int32_t g21 = 0; // 0x8f7114d4
char * g22; // 0x8f7114f0
int32_t g23 = 0; // 0x8f7125ec
char * g8[4] = {
    "null",
    "fastboot",
    (char *)&g1,
    (char *)&g2
}; // 0x8f6ac108
char * g9[3] = {
    "fastboot",
    (char *)&g1,
    (char *)&g2
}; // 0x8f6ac10c

// ------------------------ Functions -------------------------

// Address range: 0x8f61e688 - 0x8f61e7e7
int32_t update_console_token(char * a1, char * str, char * a3) {
    int32_t v1 = g31; // 0x8f61e688
    int32_t v2 = g33; // 0x8f61e688
    int32_t str2 = (int32_t)a1; // R5
    g33 = (int32_t)a3;
    int32_t v3 = g17;
    char * next_token = strtok(str, " \t\n"); // 0x8f61e6ac
    int32_t result = (int32_t)next_token; // 0x8f61e6ac_5
    g31 = result;
    if (next_token == NULL) {
        // 0x8f61e7b4
        if (v3 != g17) {
            // 0x8f61e7c4
            __stack_chk_fail();
            // branch -> 0x8f61e7c8
        }
        // 0x8f61e7c8
        g31 = v1;
        g33 = v2;
        return result;
    }
    int32_t v4; // R0
    int32_t v5; // bp+211
    while (true) {
        int32_t len = strlen("console="); // 0x8f61e6c0
        int32_t v6; // 0x8f61e784_5
        char * next_token2; // 0x8f61e784
        int32_t * str3;
        if (strncmp((char *)g31, "console=", len) == 0) {
            // 0x8f61e6dc
            strcat((char *)str2, "console=");
            str3 = &g33;
            // branch -> 0x8f61e774
          lab_0x8f61e774_2:
            // 0x8f61e774
            strcat((char *)str2, (char *)*str3);
            // branch -> 0x8f61e778
          lab_0x8f61e778:;
            // 0x8f61e778
            // branch -> 0x8f61e77c
        } else {
            int32_t len2 = strlen("androidboot.console="); // 0x8f61e6f8
            if (strncmp((char *)g31, "androidboot.console=", len2) == 0) {
                int32_t len3 = strlen("null"); // 0x8f61e718
                if (strncmp((char *)g33, "null", len3) != 0) {
                    char * found_char_pos = strchr((char *)g33, 44); // 0x8f61e740
                    int32_t v7 = (int32_t)found_char_pos; // R7
                    if (found_char_pos == NULL) {
                        str3 = &g31;
                        goto lab_0x8f61e774_2;
                    }
                    // 0x8f61e750
                    strcat((char *)str2, "androidboot.console=");
                    int32_t str4 = g33; // 0x8f61e75c
                    strncat((char *)str2, (char *)str4, v7 - str4);
                    // branch -> 0x8f61e778
                    goto lab_0x8f61e778;
                }
            } else {
                // 0x8f61e76c
                str3 = &g31;
                // branch -> 0x8f61e774
                goto lab_0x8f61e774_2;
            }
            // 0x8f61e77c
            g31 = 1;
            next_token2 = strtok(NULL, " \t\n");
            v6 = (int32_t)next_token2;
            v4 = v6;
            int32_t v8;
            if (next_token2 == NULL) {
              lab_after_if_8f61e794_0_thread:
                // after_if_8f61e794_0.thread
                g31 = v6;
                v5 = v6;
                v8 = v6;
                // branch -> 0x8f61e6b4
            } else {
              lab_after_if_8f61e794_0:
                // after_if_8f61e794_0
                g31 = v6;
                if ((g31 ^ 1) % 2 != 0) {
                    char * dest_str = strcat((char *)str2, g6); // 0x8f61e7ac
                    int32_t v9 = (int32_t)dest_str; // 0x8f61e7ac_5
                    v4 = v9;
                    v5 = v9;
                    v8 = g31;
                    // branch -> 0x8f61e6b4
                } else {
                    v5 = v6;
                    v8 = v6;
                }
            }
            // 0x8f61e6b4
            if (v8 == 0) {
                // break -> 0x8f61e7b4
                break;
            }
            // continue -> 0x8f61e6bc
            continue;
        }
        // 0x8f61e77c
        g31 = 0;
        next_token2 = strtok(NULL, " \t\n");
        v6 = (int32_t)next_token2;
        v4 = v6;
        if (next_token2 == NULL) {
            goto lab_after_if_8f61e794_0_thread;
        }
        goto lab_after_if_8f61e794_0;
    }
    // 0x8f61e7b4
    int32_t result2; // 0x8f61e7cc_2
    if (v3 != g17) {
        // 0x8f61e7c4
        __stack_chk_fail();
        result2 = v4;
        // branch -> 0x8f61e7c8
    } else {
        result2 = v5;
    }
    // 0x8f61e7c8
    g31 = v1;
    g33 = v2;
    return result2;
}

// --------------- Statically Linked Functions ----------------

// void __stack_chk_fail(void);
// char * asctime(const struct tm * tp);
// struct tm * gmtime(const time_t * timer);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// void * memset(void * s, int c, size_t n);
// int snprintf(char * restrict s, size_t maxlen, const char * restrict format, ...);
// char * strcat(char * restrict dest, const char * restrict src);
// char * strchr(char * s, int c);
// int strcmp(const char * s1, const char * s2);
// size_t strlen(const char * s);
// char * strncat(char * restrict dest, const char * restrict src, size_t n);
// int strncmp(const char * s1, const char * s2, size_t n);
// char * strncpy(char * restrict dest, const char * restrict src, size_t n);
// size_t strnlen(const char * string, size_t maxlen);
// char * strrchr(char * s, int c);
// char * strtok(char * restrict s, const char * restrict delim);
// time_t time(time_t * timer);
// int vsnprintf(char * restrict s, size_t maxlen, const char * restrict format, _G_va_list arg);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: android-ndk-r8 (4.4.3 armv5te, armv7a(arm-linux-androideabi-gcc))
// Detected functions: 17
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2017-08-06 18:36:36
